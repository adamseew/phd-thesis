
%%%%%%%%%%%%%%%%%%
%                %
% Introduction   %
%                %
\chapter{Introduction}
\label{cp:intro}

%\begin{highlight}
%    \begin{st}
%        General structure with just some dummy text.
%    \end{st} 
%\end{highlight}

\lettrine{M}{obile robots} are a class of robots with the ability to move through the environment~\citep{corke2017robotics}. Most of these robots are power-demanding devices constrained by battery limitations. Although such limitations are a common challenge in many areas, they are critical in mobile robots' design and development. They influence the level of autonomy~\citep{seewald2020mechanical}, which in turn is expected to increase in the foreseeable future~\citep{fisher2013verifying}.

To move, mobile robots combine different components which sense and interact with the surrounding environment~\citep{mei2006deployment}. The analysis and interpretation of data originating from these components require energy-demanding heterogeneous computing hardware. Planning an energy-aware path with a power-saving scheduling policy on such hardware is an underrepresented topic in the literature. In fact, many past approaches focus almost exclusively on one of these topics. For instance, some approaches generate an energy-optimized path, despite the computational energy almost equaling the actuation energy of some instances of low-energy mobile robots~\citep{sudhakar2020balancing}. Furthermore, due to the recent advancements in the computational capabilities of heterogeneous computing hardware, such as the introduction of powerful portable GPUs\findex{GPU}~\citep{rizvi2017general}, the use of computations is on the rise~\citep{abramov2012real,satria2016real,jaramillo2019visual}. Other approaches provide a power-saving scheduling policy. Yet, actuating a mobile robot requires considerable energy expenditure over mere calculations~\citep{mei2004energy,mei2005case}.

In this work, we focus on dynamic energy planning: we generate both an energy-aware plan of the path and a power-saving schedule of the computational tasks. We generate these two aspects simultaneously, exploring their tradeoffs. We demonstrate the approach both in simulation and empirically focusing on aerial mobile robots. These systems share with the broader class of mobile robots very stringent battery limitations. However, handling the battery during normal operation in flight is challenging. It would require landing to replace or recharge the battery~\citep{zamanakos2020energy}. Aerial robots are hence a perfect instance of energy-constrained systems and are the main focus of our analysis.

To formulate a mobile robot planning problem (in \fref{sec:pb-form}{Section}) dynamic energy planning, we focus on some autonomous use-cases involving mobile robots. Modern mobile robots are, in fact, commonly employed in precision agriculture, search and rescue, payload delivery, transportation, and many others. We focus mostly on the first two applied to the aerial robotics context. In summary, after some definitions, we build an energy model to predict future energy consumption in \fref{cp:model}{Chapter}. We estimate the coefficients of the model using robust estimation techniques in \fref{cp:est}{Chapter}. Here some estimates are made from sensors' data and used to derive an optimal control action. Later, we derive an optimal configuration of the path and computations use data-driven control\findex{data-driven control} and other modern optimal control techniques in \fref{cp:opt}{Chapter}. We use such optimal control for guidance and scheduling of the aerial robot in \fref{cp:gd}{Chapter}. The guidance moves physically the robot; the scheduling defines the granularity of the tasks being executed in flight.

\begin{figure}[t]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/photo}
  \caption[Opterra fixed-wing drone]{Opterra fixed-wing drone employed as an aerial robotics platform for precision agriculture {\scriptsize(photo credit: Amit Ferencz Appel)}.}   
  \label{fig:opterra}
\end{figure}

We investigate different physical mobile robotics platforms in this work but we focus most on the Opterra fixed-wing drone\findex{Opterra fixed-wing drone}~\citep{opterra} adapted for precision agriculture. Precision agriculture\findex{precision agriculture} is often put into practice~\citep{hajjaj2014review} with ground mobile robots used for harvesting~\citep{qingchun2012study,dong2011development, de2011design, aljanobi2010setup, li2008analysis, edan2000robotic}, and \Gls{acr:uav}s for preventing damage and ensuring better crop quality~\citep{puri2017agriculture, daponte2019review}. The aerial robot is shown in \fref{fig:opterra}{Figure}.

In the remainder of the chapter and before we introduce the problem in \fref{sec:pb-form}{Section}, we briefly investigate the evolution of the field of aerial robotics in the next section. We then analyze the main aerial robots available today, and how they apply to dynamic energy planning in \fref{sec:aerial-robo-types}{Section}. We then provide some further motivation for our planning in \fref{sec:motivation}{Section} and the outline of the approach in \fref{sec:outline}{Section}. Finally, we provide the structure of the remaining chapters in \fref{sec:structure}{Section}.


\section{From UAVs to Modern Aerial Robots}

Modern aerial robots are a valuable tool in robotic research and aerospace. They can be found with different names in the literature. These include unmanned aerial vehicles\findex{unmanned aerial vehicles} (\Gls{acr:uav}s)\footnote{The term unmanned is sometimes replaced by uninhabited}, unmanned aerial systems\findex{unmanned aerial systems} (\Gls{acr:uas}s), flying robots, or drones. Usually, we refer to drones, \Gls{acr:uav}s, and \Gls{acr:uas}s when these systems are semi-autonomous, or operated from the ground. \Gls{acr:uas} often denote the entire infrastructure of unmanned flight in the aerospace jargon. Aerial or flying robots, on the other hand, have advanced levels of autonomy~\citep{siciliano2016springer}. Nevertheless, all these systems have basic autonomous features such as position and altitude holding and leveling. The position holding is usually implemented using global navigation satellite system\findex{global navigation satellite system} (\Gls{acr:gnss}), altitude holding using a barometer\findex{barometer}, and leveling using inertial measurement unit\findex{inertial measurement unit} (\Gls{acr:imu}).

\begin{figure}[t]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/HA-NH-JA-19_1}
  \caption[Hewitt-Sperry Automatic Airplane, first unmanned flying machine]{The Hewitt-Sperry Automatic Airplane, also denominated ``flying bomb'', was developed in WWI and represents the first instance of a \Gls{acr:uav} {\scriptsize(photo credit: United States Naval Institute)}.}   
  \label{fig:hewitt-sperry}
\end{figure}

Uninhabited or unmanned flight has more than a century of developments~\citep{siciliano2016springer}. The origin of the field of aerial robotics, which deals with the design and development of aerial robots, dates back to the first guided missiles~\citep{siciliano2016springer}. Hewitt-Sperry Automatic Airplane\findex{Hewitt-Sperry automatic airplane}, also denominated ``flying bomb'', developed in 1917 during World War I\findex{World War I} (WWI)~\citep{keane2013brief,valavanis2015handbook} is often referred to as the first unmanned flying machine; a milestone reached relatively soon if we consider that the first heavier-than-air flight in history was demonstrated 14 years earlier, on December 17, 1903, with the Wright Flyer I by Wilbur and Orville Wright\findex{Wright brother} (or the Wright brothers). The Hewitt-Sperry Automatic Airplane used a gyroscope\findex{gyroscope}, invented by Elmer Sperry~\citep{keane2013brief}, mechanically connected to the control surfaces and thus successfully integrated a control feedback loop~\citep{siciliano2016springer}. It is shown in \fref{fig:hewitt-sperry}{Figure}.

In the early days, these flying machines were labeled remotely piloted vehicles\findex{remotely piloted vehicles} (\Gls{acr:rpv}s)~\citep{anderson2005introduction}. Many instances from WWI on of such early \Gls{acr:uav}s were designed for military purposes. In the 1950s, United States used a remotely controlled vehicle, the Ryan Firebee\findex{Ryan Firebee}, for reconnaissance in Vietnam, and Israel was the first to use a \Gls{acr:rpv} in a combat situation~\citep{anderson2005introduction}. Other instances of these vehicles include the V-1 flying bomb~\findex{V-1 flying bomb} from 1944 (deployed by the unified armed forces of nazi Germany) and the Lockheed D-21~\findex{Lockheed D-21} from 1962 (deployed by the United States Air Force).

Global positioning system\findex{global positioning system} (\Gls{acr:gps}) at the end of 1970 allowed the \Gls{acr:uav}s to be used in surveillance. These systems were later integrated with cameras and other sensors~\citep{siciliano2016springer}, in what are known as modern aerial robots.

In recent years unmanned flight has been applied in many civilian applications~\citep{gonzalez2017unmanned}. Modern aerial robots are increasingly used in remote sensing\findex{remote sensing}~\citep{noor2018remote,tang2015drone,milas2018drones}, surveillance\findex{surveillance}~\citep{paucar2018use,burkle2009collaborating}, meteorology\findex{meteorology}~\citep{schuyler2019using}, search and rescue\findex{search and rescue}~\citep{pensieri2020drones,karaca2018potential,cui2015drones,seguin2018unmanned}, precision agriculture~\citep{daponte2019review,puri2017agriculture}, transportation, and payload delivery\findex{payload delivery}~\citep{kellermann2020drones}. The former four categories fall into the area of reconnaissance, surveillance, and target acquisition\findex{reconnaissance, surveillance, and target acquisition} (\Gls{acr:rsta}) and do not require advanced autonomy. Precision agriculture, transportation, and payload delivery are often realized using to a greater or lesser extent some advanced levels of computational intelligence~\citep{siciliano2016springer}. 

Modern aerial robots are designed to handle unexplored terrain with little interaction as opposed to past \Gls{acr:uav}s operated mainly by a human operator~\citep{siciliano2016springer}. Instances of modern aerial robots are in fact expected to autonomously adapt and possibly interact in a broad variety of environmental conditions. 

\begin{figure}[t]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/jpegPIA24550}
  \caption[NASA's Ingenuity Mars Helicopter]{NASA's Ingenuity Mars Helicopter. A rotary-wing coax aerial robot that achieved the first powered, controlled flight on another planet on April 19, 2021. The project is solely a demonstration of technology {\scriptsize(photo credit: NASA Jet Propulsion Laboratory)}.}   
  \label{fig:ingenuity}
\end{figure}

In summary, aerial robots have a relatively recent past. Some initial experiments of unmanned flights were performed shortly after the first heavier-than-air manned, powered flight. These initial experiments were mostly developed for military purposes, whereas modern aerial robots are used in a broad range of civil autonomous scenarios. Aerial robots are expected to grow significantly in numerous areas of robotics research ranging from agriculture to planetary exploration. For the latter, \fref{fig:ingenuity}{Figure} shows NASA's Ingenuity Mars Helicopter. A small coaxial aerial robot that performed the first powered, controlled flight on another planet on April 19, 2021. Aerial robots for planetary exploration are to be further deployed in future explorations endeavors, for instance, to study Saturn's moon Titan~\citep{voosen2019nasa}.

Finally, we conclude this section with a quote from~\citep{anderson2005introduction}: ``the Wright brothers worked so hard to put humans in the air in flying machines, a hundred years later some [...] are working hard to take them out of flying machines''.


\section{Common Classes of Aerial Robots}
\label{sec:aerial-robo-types}

Numerous different types of aerial robots have emerged ever since their first introduction. We briefly investigate the most studied classes in the robotics literature and relate them to the dynamic energy planning that we focus on in this work. 

The two most generic classes are heavier-than-air and lighter-than-air aerial robots.

Heavier-than-air aerial robots\findex{heavier-than-air aerial robots} are divided into fixed- and rotary-wings~\citep{siciliano2016springer}, and some recent developments in bio-inspired robotics study flapping-wings~\citep{floreano2015science}\findex{flapping-wings}. Examples of flapping-wings are Delfly II in \sref{lab:delfly}~\citep{percin2012flow}, and Nano-Hummingbird in \sref{lab:nano} in \fref{fig:plot10}{Figure}. We discuss in detail heavier-than-air aerial robots in this work, as they are a common platform for robotics research. 

Rotary-wing aerial robots\findex{rotary-wings} are highly maneuverable and can perform stationary vertical flight (commonly referred to as hovering\findex{hovering})~\citep{siciliano2016springer}. These systems can be classified into further categories, which include multirotors\findex{multirotors} (such as quadrotors\findex{quadrotors} or quadcopters\findex{quadcopters}, hexacopters\findex{hexacopters}, and octocopters\findex{octocopters}), conventional helicopters\findex{helicopters} (these have one main and one tail rotor), and a coax\findex{coax} (these have counter-rotating coaxial rotors)~\citep{corke2017robotics}. Some examples of rotary-wing aerial robots such as quadrotors are DJI Mavic Mini in \sref{lab:mavic}, and DJI Phantom 4 in \sref{lab:phantom} in \fref{fig:plot10}{Figure}. In the same figure, DJI Agras T16 in \sref{lab:agras}, and DJI Matrice 600 in \sref{lab:matrice} are hexacopters.

Fixed-wing aerial robots\findex{fixed-wings} have wings to provide the lift, some control surfaces for maneuvering, and a propeller for forwarding thrust; a shared principle with a common passenger aircraft~\citep{corke2017robotics}. An example constitutes the Opterra adapted for precision agriculture in \fref{fig:opterra}{Figure}, Cumulus in \sref{lab:cumulus}, Ebee in \sref{lab:ebee}, and Penguin BE in \sref{lab:penguin}~\citep{haugen2016monitoring} in \fref{fig:plot10}{Figure},

We discuss the dynamic forces which govern the flight of rotary- and fixed-wings aerial robots in \fref{cp:gd}{Chapter}.

Common instances of lighter-than-air aerial robots\findex{lighter-than-air aerial robots} are blimps\findex{blimps} (or non-rigid airships). They usually rely on a gas--such as helium enclosed in a protected envelope~\citep{burri2013design}--to generate the lifting force~\citep{fui2017recent}. An omnidirectional spherical blimp is shown in \fref{fig:skye-blimp}{Figure}. Blimps are similar to balloons but provide basic maneuverability, whereas, in a balloon, only the altitude can be controlled~\citep{colombatti2011lighter}.

\begin{figure}[h]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/IMG_2612}
  \caption[Skye, an omnidirectional spherical blimp]{Skye, an omnidirectional spherical blimp developed by ETH Z\"urich for entertainment purposes. It has a camera system and combines the energy-efficient flight of a blimp with the characteristics of a quadrotor {\scriptsize(photo credit: ETH Z\"urich)}.}   
  \label{fig:skye-blimp}
\end{figure}

Some other classifications found in aerial robotics literature often rely on size and maneuverability and include micro aerial vehicles (MAVs)\findex{micro aerial vehicles}. These are aerial robots with all dimensions lower than 15 cm. Vertical take-off and landing (VTOLs)\findex{vertical take-off and landing} aerial robots are aerial robots flying in a fixed-wing configuration except if taking-off and landing where they use thrust from rotors rather than lift from wings. 

While rotary-wings are the most maneuverable, less-than-air aerial robots are the least. These, however, have the highest endurance followed by fixed-wing aerial robots. Flapping-wings and mixed configurations, such as VTOLs, fall into the intersection of rotary and fixed-wings for what concerns maneuverability and endurance~\citep{siciliano2016springer}. The energy requirements are critical for all aerial robots, but the difference of motion and computation energy (\Gls{acr:mace}) varies greatly. The energy--inversely proportional to endurance--is highest in rotary-wings and lowest in lighten-than-air aerial robots. The dynamic energy planning approach thus relies on both power-saving task scheduling and energy-efficient path planning for the fixed-wings robots while relying almost exclusively on energy-efficient path planning for rotary-wing aerial robots. In the former \Gls{acr:mace} is close to zero, in the latter is usually high except in energy optimized designs such as some rotary-wing MAVs. Hypothetically, in lighter-than-air aerial robots, \Gls{acr:mace} might be negative; the energy planning approach would rely heavily on power-saving task scheduling.


\section{Motivation}
\label{sec:motivation}

\begin{figure}[t!]
  \centering
  \footnotesize\fontfamily{phv}\selectfont
  \input{figures/plot10.tikz}
  \caption[.]{Different aerial robots in relation to the M\&CE and flight time. Heavier-than-air aerial robots \sref{lab:cumulus}{}--\sref{lab:nano}{} include flapping-wings \sref{lab:delfly}{},~\sref{lab:nano}{} that have a negative M\&CE (computations scheduling is to be accounted for most in planning), whereas rotary-wings have a positive M\&CE \sref{lab:matrice}{},~\sref{lab:agras}{} (path planning is to be accounted for most in planning). Some rotary-wings have a M\&CE closer to zero \sref{lab:mavic}{},~\sref{lab:phantom}{}. In general, rotary-wings have a short flight time. Fixed-wings \sref{lab:cumulus}{}--\sref{lab:opterra}{} have a considerably longer flight time and M\&CE close to zero (computations scheduling and path planning have both to be accounted for in planning). Lighter-than-air aerial robots \sref{lab:skye}{} have hypothetically a relatively long flight time and lower than zero M\&CE {\scriptsize(photos credit: \srefscriptsize{lab:cumulus} to Sky-Watch, \srefscriptsize{lab:matrice} to Rise Above, \srefscriptsize{lab:agras} to Aeromotus, \srefscriptsize{lab:mavic} to Digital Photography Review, \srefscriptsize{lab:phantom} to ePHOTOzine, and \srefscriptsize{lab:nano} to DARPA}.}
  \label{fig:plot10}
\end{figure}

Many applications that involve aerial robots have strict battery constraints. Although this is a common problem to most mobile robots, aerial robots are particularly affected. The autonomy of these systems is consequently affected by the availability of the power source. A typical example of an aerial robotics scenario in this situation is a robot following a path and performing some onboard computational tasks. For instance, the robot might detect ground patterns and notify other ground-based actors with little human interaction in precision agriculture or another autonomous use case. Energy requirements of heterogeneous computing hardware\findex{heterogeneous computing hardware} which power autonomous capabilities in these use cases is a further complication in these scenarios. Computing hardware is involved in the planning and often runs computer vision or other complex algorithms, as opposed to the microcontroller\findex{microcontroller}. The latter runs motion primitives by directly interfacing actuators (such as servos\findex{servo} for the control surfaces\findex{control surface}) and motors\findex{motor}.

\subsection{Path planning and computations scheduling}

It is uncommon to find a ready-to-use solution for planning both the path and scheduling the computations of these systems in an energy-aware fashion (we discuss in detail the state-of-the-art in this regard in \fref{cp:soa}{Chapter}). Planning these two aspects simultaneously would pose an advantage in terms of autonomy by, e.g., optimizing both the path and computations in the function of the battery state of charge (\Gls{acr:soc}). 

For certain classes of aerial robots with \Gls{acr:mace} close or lower than zero, the autonomy can directly influence the battery state. For these classes, it is desirable to reschedule the computations energy-wise in-flight during a motion energy demanding phase. For instance, a fixed-wing aerial robot might be flying headwinds (with the wind vector parallel and opposite to the direction of motion) and utilizing more energy than planned. It would be of advantage to reschedule the tasks accordingly to save energy needed for motion. During the same flight, the wind direction might suddenly change. The fixed-wing craft, now flying tailwinds, requires less motion energy. It could then potentially increase the level of computations by rescheduling the tasks. In the same flight, the battery might be subject to sudden drops (due to e.g., temperature changes) requiring replanning again by, e.g., shortening the path. It is clear that planning the path and scheduling the computations simultaneously in all these cases is the most desirable course of action.

In \fref{fig:plot10}{Figure} we show the \Gls{acr:mace} against the flight time if different aerial robots. We observe that fixed-wings are the aerial robots that would advantage most simultaneous path planning and computations scheduling as it has \Gls{acr:mace} close to zero and a relatively long flight time. Although some rotary-wings have \Gls{acr:mace} also close to zero, their flight time is generally relatively short. Flapping-wing and lighter-than-air aerial robot require considerably less energy for the motion, and thus they have a negative \Gls{acr:mace}.

\subsection{Objective}

In the remainder of this work, we refer to computational tasks that can be scheduled in an energy-aware fashion as computations, opposed to the other tasks that have no significant effect on energy consumption. We assume the mobile robot is carrying heterogeneous computing hardware to run the computations.

\begin{figure}[t!]
  \centering
  \input{figures/plot2.tikz}
  \caption[The covering problem in a precision agriculture scenario]{The covering problem in a precision agriculture scenario. The aerial robot has to cover an agricultural field that forms a polygon (blue/transparent area in the frame) and run some autonomous tasks {\scriptsize(photo credit: Amit Ferencz Appel)}.}
  \label{fig:plot2}
\end{figure}

As an example, we refer to an aerial robot in a precision agriculture scenario (see \fref{fig:opterra}{Figure}), which covers an agricultural field. In abstract terms, the field is represented by a polygon (see \fref{fig:plot2}{Figure}) and the aerial robot detects some patterns on such polygon using a convolutional neural network (CNN). The aerial robot further communicates the position of a detected pattern to other, ground-based actors. Detecting the patterns usually involves heterogeneous computing elements (GPU\findex{GPU} and/or multiple CPU\findex{CPU} cores) and consumes a significant amount of energy as opposed to communication. Detection is a computation, while communication is an (energy-inexpensive) task.

We are interested in the energy optimization of the path and computations under uncertainty (atmospheric interferences) in-flight and refer to it as dynamic energy planning. Unlike most of the past mobile robotics planning literature, the approach that we propose plans these two aspects simultaneously. Such planning would find optimal tradeoffs\findex{tradeoffs} between the path, computations, and energy requirements. Current generic planning solutions for aerial robots do not plan the path and computations dynamically, nor are they energy-aware. They are often semi-autonomous: the path and computations are static and usually defined using planning software~\citep{daponte2019review}. Instances of the planning software include famous flight controllers~\citep{px4,papa}. Such a state of practice has prompted us to pursue the presented work on dynamic energy planning for aerial robots which plans both the path and computations while the aerial robot is flying and its batteries draining. 

We formally define the robot planning problem after outlining the approach in the next section.


\section{Outline of the Approach}
\label{sec:outline}

The approach that we present in this work combines, generalizes, and extends some past body of knowledge (see \fref{cp:soa}{Chapter}) on mobile robot planning problems. The approach addresses the increasing computational demands, in relation to aerial robot's energy consumption, path, and autonomy. We apply the approach to aerial robots in different autonomous scenarios. 

The approach necessitates a user-defined initial plan that is replanned energy-wise using an energy model for future prediction. In the remainder of this work, we progressively build an algorithm that inputs a user-specified initial plan, estimates an energy model, evaluates future energy consumption, and eventually replans parameters relative to the path and computations. The initial plan consists of different stages. At each stage, the mobile robot travels a path and executes some computations. The plan then contains the parameters to alter the path and computations along with an energy budget. The alterations are bounded. There are path constraint sets that bound the path alterations and computation constraint sets, one per each computation parameter, that bound computations alterations.

We use the concept of different stages to model complex paths. For instance, the path might contain multiple circles and lines, as shown in \fref{sec:flight-plan}{Subsection}. The approach then guides the aerial robot on such a complex path using vector field~\citep{de2017guidance} that converges to the path. The robot switches between the paths as soon as it reaches specific triggering points. 

The approach further relies on \powprof{}, a profiling tool presented in~\citep{seewald2019coarse} to model the computations. Future energy predictions are achieved via a formally proved periodic energy model that accounts for the uncertainty. We use Fourier analysis to derive the model, and state estimation to address the uncertainty. Periodicity is often present due to repetitive patterns in the plan~\citep{seewald2020mechanical}. Indeed, mobile robots often iterate over a set of tasks and paths. Given that the plan is periodic, we expect the energy consumption to approximately evolve periodically. We describe in detail such model in \fref{cp:model}{Chapter}. 

The replanning of the path and computations is achieved with modern optimal control techniques, such as model predictive control (MPC)~\citep{rawlings2017model}. The control is data-driven. Energy sensor data estimates some coefficients of the model used to predict the future energy consumption in presence of uncertainty. The replanning is done under an energy budget--the battery capacity and other battery parameters. Our goal is to complete the plan with the highest possible parameters configuration as the mobile robot executes the plan. 

\subsection{Periodic model}

\begin{figure}[t]
  \footnotesize
  \centering
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \footnotesize\fontfamily{phv}
    \input{figures/energy_1.tikz}
    \caption{Energy evolution}
    \label{fig:energy-1}
  \end{subfigure}\hspace{2mm}
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \footnotesize\fontfamily{phv}
    \input{figures/spectrum_1.tikz}
    \caption{Power spectrum}
    \label{fig:spectrum-1}
  \end{subfigure}
  \caption[Energy data of a fixed-wing aerial robot]{Empirical energy data collected flying a fixed-wing aerial robot's plan and covering the polygon in \fref{fig:plot2}{Figure}. The data shows that the energy signal is periodic over time with the fixed-wing aerial robot reiterating a set of paths.}
\end{figure}

Some collected energy data from the Opterra (in \fref{fig:opterra}{Figure}) adapted for precision agriculture scenario along its power spectrum back the choice of the periodic energy model. A periodic energy evolution of a fixed-wing aerial robot flying a plan and covering the polygon in \fref{fig:plot2}{Figure} (we describe the fixed-wing aerial robot plan in detail in \fref{sec:flight-plan}{Section}) is shown in \fref{fig:energy-1}{Figure}. \fref{fig:spectrum-1}{Figure} shows its frequency spectrum (the data are uniformly sampled). The spectrum is centered at zero frequency, which peaks at 4$\cdot$10${}^{\text{5}}$ and indicates the shift on the power-axis in \fref{fig:energy-1}{Figure}. The power spectrum shows that the energy evolution from \fref{fig:energy-1}{Figure} needs approximately three frequencies to be modeled. To obtain the spectrum in frequency space, we computed the Fourier transform.

\subsection{Applications}

The dynamic energy planning in this work applies mostly to modern aerial robots with a certain degree of autonomy: the aerial robot is assumed to perform a predefined set of tasks over a given space (the plan). Although most of the guidance in \fref{cp:gd}{Chapter} is specifically meant for aerial robots, the approach can be easily adapted to other energy-constrained mobile robots. For instance, we have applied the approach in the space robotics context~\citep{seewald2020beyond}. We discuss applications out of aerial robotics further in \fref{cp:conc}{Chapter}.

We focus on the precision agriculture scenarios, where the aerial robot covers a given agricultural field (a polygon) and searches for ground hazards. The covering problem in the precision agriculture scenario is illustrated in \fref{fig:plot2}{Figure}. The plan is structured as follows. Path-wise, the Opterra fixed-wing aerial robot from \fref{fig:opterra}{Figure} flies in circles and lines covering the polygon. Computation-wise, it detects hazards using the CNN and notifies grounded mobile robots employed for, e.g., harvesting. The approach alters the plan; it controls the processing rate and the radius of the circles affecting the distance between the lines. With this scenario, we validated the work experimentally.

We observe that not only the path but also the computations significantly impact the energy, with a potential extension of up to 13 minutes over an hour by switching from the highest to the lowest level of computations in presence of a standard battery.


\section{Problem Formulation}
\label{sec:pb-form}

Before formulating the mobile robot planning problem in \fref{sec:plan-pb}{Section}, we provide a formal definition of some of the main constructs that we use in the remainder of this work in \fref{sec:definitions}{Section}, along with the derivation of the example of the precision agriculture scenario that we extend in each chapter in \fref{sec:flight-plan}{Section}.

\subsection{Energy modeling}
\label{sec:definitions}

Firstly, we give a formal definition of computations, motion, their energy, and M\&CE that we extensively use in the remainder of this work.

\begin{highlight}
  \begin{defn}[Computations/motion]\label{def:comps}
    Computations are energy-demanding computational tasks executed on heterogeneous computing hardware carried by a mobile robot.
    
    Motion is the act of moving in the surrounding environment. It is achieved with the aid of microcontrollers (opposed to heterogeneous computing hardware), sensors, actuators, motors, and other components. 
  \end{defn}
\end{highlight}

Autonomous capabilities are often achieved by the interconnection of computations and motion. We refer to the energy needed by the computations as the computation energy, opposed to the motion energy.

\begin{highlight}
\begin{defn}[Computations/motion energy]
  Given a schedule composed of $i$ computations $s:=\{s_1,s_2,\dots,s_i\}$, the computation energy is the energy spent by heterogeneous computing hardware while executing the schedule $s$.
  
  The motion energy is the remaining energy the mobile robot requires for the motion.
\end{defn}
\end{highlight}

Computations energy and motion energy are measured in watts if instantaneous or average. They are measured in joules if over a given time interval.

\Gls{acr:mace}\findex{difference of motion and computational energy} that we introduced in \fref{sec:aerial-robo-types}{Section} is the difference of average motion and computation energy. It is measured in watts and it gives a measure of which of the two energy components is predominant. For \Gls{acr:mace} greater than zero, the motion energy dominates over the computations. The dynamic planning approach plans first an energy-efficient path. For \Gls{acr:mace} lower than zero, the computation energy dominates. The dynamic planning approach plans first a power-saving schedule. For \Gls{acr:mace} close to zero, both energy components are important energy-wise. The dynamic planning approach plans both an energy-efficient path and power-saving schedule to a similar extent.

\subsection{Path functions}

To model the path we use multiple mathematical functions $\varphi_1,\varphi_2,\dots$ in an equivalent number of plan's stages. The path is expressed in 2D at a fixed altitude $h$, the function $\varphi:\mathbb{R}^2\rightarrow\mathbb{R}$ quantifies the distance of a generic point $\mathbf{p}$ in the 2D space on the $z$-axis. For instance one can define a line
\begin{equation}\label{eq:basic-path}
  \varphi(x,y):=ax+by+c,
\end{equation}
where $a,b,c\in\mathbb{R}$ are given constants. A generic point $\mathbf{p}:=(x_{\mathbf{p}},y_{\mathbf{p}})$ intersects $\varphi(x,y)$ on a specific value of the $z$-axis.

\begin{figure}[t]
  \centering
  \input{figures/plot1.tikz}
  \caption[Concept of the path and generic point in space]{The path defined as mathematical function $\varphi=h$ at a fixed altitude $h$. A generic point $\mathbf{p}$ in 2D space quantifies the distance $\varphi(\mathbf{p})=d$ on the $z$-axis from $h$.}
  \label{fig:plot1}
\end{figure}

The concept is shown in \fref{fig:plot1}{Figure} for $c$ zero and $a,b$ minus one and two respectively. A generic point $\mathbf{p}:=(x_{\mathbf{p}},y_{\mathbf{p}})$ intersects the plane
\begin{equation}
  \varphi(x,y):=2y-x,
\end{equation}
at $z=\varphi(\mathbf{p})$. The path at a fixed altitude is then $\varphi(x,y)=0$, or more generally $\varphi(x,y)=h$ with $h\in\mathbb{R}$. $\varphi(\mathbf{p})-h$ is then the distance on $z$-axis.

\subsection{Stages and triggering points formulation}

To specify an integer-valued set, we relay on the following mathematical notation: $[x]$ is the set positive set $\{0,1,\dots,x\}\subseteq\mathbb{Z}_{\geq 0}$, where $x\in\mathbb{Z}_{\geq 0}$. $[x]_{>0}$ is the strictly positive set $\{1,2,\dots,x\}\subseteq\mathbb{Z}_{> 0}$ (or $[x]/\{0\}$). where $x\in\mathbb{Z}_{>0}$. 

Bold lower-case letters, such as $\mathbf{x}$, denote vectors. Upper-case letters, such as $X$, denote matrices.

Parameters are variable values that might either be reals $\mathbb{R}$ or integers $\mathbb{Z}$. We use such values to dynamically plan the path and computations. $c_{i,j}$ denotes the $j$-th parameter of the $i$-th parameters set $c_i$
\begin{equation}
  c_i=\{c_{i,1},c_{i,2},\dots,c_{i,j},\dots\}.
\end{equation}

The user-defined plan has a fixed number of stages $i=\{1,2,\dots\}$, and we assume that at each stage $i$ the mobile robot executes some computations and travels a path using the parameters set $c_i$.

Parameters are bounded. $\underline{c}_{i,j}$ is the lower bound of the parameter $c_{i,j}$. $\overline{c}_{i,j}$ is the upper bound
\begin{equation}
  \underline{c}_{i,j}\leq c_{i,j}\leq\overline{c}_{i,j}.
\end{equation}

We assume there are $\rho$ path-specific parameters and $\sigma$ computation-specific parameters for every stage. This means that the path at stage $i$ can be replanned with $\rho$ path parameters
\begin{equation}\label{eq:path-params}
    c_i^\rho:=\{c_{i,1},c_{i,2},\dots,c_{i,\rho}\},
\end{equation}
while the computations (i.e., the energy-demanding computational task executed on heterogeneous computing hardware from \fref{def:comps}{Definition}) with $\sigma$ computation parameters 
\begin{equation}\label{eq:comp-params}
    c_i^\sigma:=\{c_{i,\rho+1},c_{i,\rho+2},\dots,c_{i,\rho+\sigma}\}.
\end{equation}

We then express the path as a continuous twice differentiable function $\varphi_i:\mathbb{R}^2\times\mathbb{R}^\rho\rightarrow\mathbb{R}$ of a point and the path parameters. The concept is similar to the path with no parameters from \frefeq{eq:basic-path}; here the parameters are used to alter the path and thus change the energy consumption. 

We express the computations as the value of the computation parameters. These are also employed for the purpose of energy alteration by, e.g., decreasing the granularity of a given computation and thus lowering instantaneous energy consumption. We discuss the alteration of the energy with path parameters and computation parameters further in \fref{sec:nom-cont}{Section} and \fref{sec:merging}{Section}.

We formally define the stage in \fref{def:stage}{Definition}.

\begin{highlight}  
  \begin{defn}[Stage]\label{def:stage}
    Given $\mathbf{p}(t)$, a point of a mobile robot travelling at an altitude $h\in\mathbb{R}_{\geq 0}$ with respect to an inertial navigation frame $\mathcal{O}_W$, the $i$-th \emph{stage} $\Gamma_i$ at time instant $t$ of a plan $\Gamma$ is
    \begin{equation*}\begin{split}
      \Gamma_i:=\{\varphi_i(\mathbf{p}(t),c_i^\rho),c_i^\sigma\mid
      \,&\forall j\,\in\,[\rho]_{>0},\,c_{i,j}\,\,\,\,\,\,\,\in\mathcal{C}_{i,j},\,\\
        &\,\forall k\in[\sigma]_{>0},\,c_{i,\rho+k}\in\mathcal{S}_{i,k}\,\},
    \end{split}\end{equation*}
    where $\mathcal{C}_{i,j}:=[\underline{c}_{i,j},\overline{c}_{i,j}]\subseteq\mathbb{R}$ is the $j$-th path parameter constraint set, and $\mathcal{S}_{i,k}:=[\underline{c}_{i,\rho+k},\overline{c}_{i,\rho+k}]\subseteq\mathbb{Z}_{\geq 0}$ the $k$-th computation parameter constraint set.
  \end{defn}
\end{highlight}

We note that the altitude $h$ from \fref{def:stage}{Definition} is not strictly fixed. It might change at different flying phases, and under different atmospheric conditions.

Furthermore, we merge the computation constraint sets and the path constraint set in a single constraint set for simplicity. The constraint set for the $i$-th stage
\begin{equation}\label{eq:constraint-set}
  \mathcal{U}_i:=\begin{cases}
  \mathcal{C}_{i,j} & \text{for } c_{i,j} \text{ with } j\leq\rho\\
  \mathcal{S}_{i,j-\rho} & \text{for } c_{i,j} \text{ with } \rho<j\leq\sigma
\end{cases}.\end{equation}

To move from a given stage $\Gamma_i$ to the next stage $\Gamma_{i+1}$, we define some specific points. As soon as the mobile robot reaches the proximity of these points, it switches to the next stage.

\begin{highlight}  
  \begin{defn}[Triggering, and final point]\label{def:trigs}
    The point $\mathbf{p}_{\Gamma_{i}}$ that allows the transition between $\Gamma_i$ and $\Gamma_{i+1}$ is called \emph{triggering point}. The last triggering point $\mathbf{p}_{\Gamma_{l}}$ relative to the last stage $\Gamma_l$ is called \emph{final point}.
  \end{defn}
\end{highlight}

\subsection{Plan formulation}

We now define the plan in \fref{def:plan}{Definition} as a finite state machine. It returns at any point in space a specific stage.

\begin{highlight}  
  \begin{defn}[Plan]\label{def:plan}
    Given $\mathbf{p}(t)$ from \fref{def:stage}{Definition}, the \emph{plan} is a finite state machine (FSM) $\Gamma$, where the state-transition function $s:\bigcup_i{\Gamma_i}\times\mathbb{R}^2\rightarrow\bigcup_i{\Gamma_i}$ maps a stage and a point to the next stage
    \begin{equation*}s(\Gamma_i,\mathbf{p}(t)):=\begin{cases}
      \Gamma_{i+1} & \text{if }\mathbf{p}(t)=\mathbf{p}_{\Gamma_i}\\
      \Gamma_i & \text{otherwise}
    \end{cases}.\end{equation*}
  \end{defn}
\end{highlight}

We illustrate the definition of plan, stage, trigerring, and final points in \fref{fig:state-machine}{Figure} and \fref{fig:state-machine2}{Figure}.

\begin{figure}[h]
  \center
  \begin{tikzpicture}[shorten >=.5pt,node distance=12.5ex,on grid,auto,initial text=\footnotesize\fontfamily{phv}\selectfont{start}]
    \node[state,initial] (q_i) {$\Gamma_1$}; 
    \node        [right=of q_i] (q_dots0) {$\cdots$};
    \node[state] (q_0) [right=of q_dots0] {$\Gamma_i$};
    \node        (q_dots1) [right=of q_0] {$\cdots$};
    \node[state,accepting] (q_f) [right=of q_dots1] {$\Gamma_f$};
    \path[->]
    (q_i) edge node {$\mathbf{p}_{\Gamma_{1}}$} (q_dots0)
    (q_dots0) edge node{$\mathbf{p}_{\Gamma_{i-1}}$} (q_0)
    (q_0) edge node {$\mathbf{p}_{\Gamma_i}$} (q_dots1)
    (q_dots1) edge node {$\mathbf{p}_{\Gamma_{l}}$} (q_f)    
    (q_i) edge [loop above] node {$\mathbf{p}(t_1)$} (q_i)
    (q_0) edge [loop above] node {$\mathbf{p}(t_2)$} (q_0)
    (q_f) edge [loop above] node {$\mathbf{p}(t_3)$} (q_f)
    ; %end path 
    \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=10pt},yshift=0pt]
    (q_i.south west) -- (q_f.south west) node [black,midway,yshift=-9ex]{$\Gamma$};
  \end{tikzpicture}
  \caption[The plan definition]{The plan definition as an FSM. Each state is a stage $\Gamma_i$, the transition happens in proximity of specific points called triggering points $\mathbf{p}_{\Gamma_i}$. The accepting stage $\Gamma_f$ indicates the termination of the plan.}
  \label{fig:state-machine}
\end{figure}

\fref{fig:state-machine}{Figure} illustrates the transition between the stages with the FSM. The triggering point $\mathbf{p}_{\Gamma_{i-1}}$ allows the transition to the stage $\Gamma_i$. The robot remains in the stage with any generic point $\mathbf{p}(t_2)$. It eventually enters the stage $\Gamma_{i+1}$ with the triggering point $\mathbf{p}_{\Gamma_i}$ and so on, until it reaches the final point. $\Gamma_f$ is the accepting stage (it indicates that the robot has completed the plan).

\begin{figure}[h]
  \center
  \begin{tikzpicture}[shorten >=1pt,node distance=27ex,on grid,auto]
    \node        (q_dots0) {$\cdots$};
    \node[state] (q_0) [right=of q_dots0] {$\Gamma_i$};
    \node        (q_dots1) [right=of q_0] {$\cdots$};   
    \path[->]
    (q_dots0) edge node{$\mathbf{p}_{\Gamma_{i-1}}(c_1^\rho,\dots,c_{i-1}^\rho)$} (q_0)
    (q_0) edge node {$\mathbf{p}_{\Gamma_i}(c_1^\rho,\dots,c_{i}^\rho)$} (q_dots1)    
    (q_0) edge [loop above] node {$\mathbf{p}(t_2)$} (q_0)
    ; %end path
  \end{tikzpicture}
\caption[Detail of a stage in the FSM]{Detail of the stage $\Gamma_i$ in the FSM. The triggering points used to transition between stages (states in the FSM) re expressed in function of the last and/or previous triggering points.}
\label{fig:state-machine2}
\end{figure}
    
Generally, one can express the triggering points in function of the $i$-th trajectory parameters $c_{i}^{\rho}$, or any previous trajectory parameters, propagating the information therein if necessary (see \fref{fig:state-machine2}{Figure}). We further expand on this notion in the example in \fref{sec:flight-plan}{Section}.

The plan that we show in \fref{fig:state-machine}{Figure} does not have backwards loops. We discuss more complex plans in \fref{cp:conc}{Chapter}. 

\subsection{Example}
\label{sec:flight-plan}

In this section, we discuss an example of a flight plan for autonomous robots addressing the covering problem in \fref{fig:plot2}{Figure}. We assume the polygon is regular and has four sides (it is a rectangle). An intuitive static plan $\Gamma$ can be composed of lines connected by circles. The distance between the lines can be then used as a measure of the quality of the coverage. Such intuitive static plan is illustrated in \fref{fig:plot3}{Figure}.

\begin{figure}[t]
  \centering
  \input{figures/plot3.tikz}
  \caption[Intuitive plan to cover a regular polygon with four sides]{An intuitive plan to cover a regular polygon with four sides. The plan is composed of circles $\varphi_2,\varphi_4$ and lines $\varphi_1,\varphi_3$ (gray lines). To switch between paths the aerial robot reaches the proximity of triggering points ($\mathbf{p}_{\Gamma_1}:=(x_{\Gamma_1},y_{\Gamma_1}),\mathbf{p}_{\Gamma_2},\mathbf{p}_{\Gamma_3},\mathbf{p}_{\Gamma_4}$). The dashed blue line indicates the triggering points, and the black line is the planned flight. The rest of the polygon is covered iterating these primitive paths $\varphi_1,\varphi_2,\varphi_3,\varphi_4$.}
  \label{fig:plot3}
\end{figure}

The intuitive plan can be used to solve the covering problem with a rotary-wing aerial robot. However, it is unsuitable for a fixed-wing craft such as the Opterra that we use for the precision agriculture scenario in this work (see \fref{fig:opterra}{Figure}). Fixed-wing aerial robots have considerably reduced maneuverability compared to rotary-wings. They are generally unable to perform quick turns in flight.

An updated version of the intuitive plan for fixed-wing aerial robots is illustrated in \fref{fig:plot4}{Figure}.

\begin{figure}[p!]
  \centering
  \input{figures/plot4.tikz}
  \caption[Fixed-wing aerial robot's plan to cover a regular polygon with four sides]{Fixed-wing aerial robot plan to cover a regular polygon with four sides. The plan covers the polygon with the same principle of the intuitive plan in \fref{fig:plot3}{Figure} but preserving long turns necessary for the flight of a fixed-wing craft. Likewise in \fref{fig:plot3}{Figure}, the entire polygon is covered iterating the primitive paths $\varphi_1,\varphi_2,\varphi_3,\varphi_4$ (gray lines). The dashed blue line indicates the triggering points, and the black line is the planned flight. The height and length of the polygon are $y_{\Gamma_3}-y_{\Gamma_1}$ and $lx_d/4$.}
  \label{fig:plot4}
\end{figure}

The paths that correspond to the fixed-wing aerial robot's plan 
\begin{subequations}\label{eq:basic-plan}\begin{align}
\varphi_1(\mathbf{p}(t))&:=x-10,\label{eq:line1}\\
\varphi_2(\mathbf{p}(t))&:=(x-85)^2+(y-10)^2-5625,\label{eq:circ1}\\
\varphi_3(\mathbf{p}(t))&:=x-160,\label{eq:line2}\\
\varphi_4(\mathbf{p}(t))&:=(x-90)^2+(y-140)^2-4900,\label{eq:circ2}\end{align}
\end{subequations}
where $x,y$s are the $x$- and $y$-coordinates of a generic point $\mathbf{p}(t)$. 

The triggering points (the points in which proximity occurs the change of stages) are then the points
\begin{equation}\label{eq:basic-plan-trigs}
  \mathbf{p}_{\Gamma_1}:=(10,10),\,\mathbf{p}_{\Gamma_2}:=(160,10),\,\mathbf{p}_{\Gamma_3}:=(160,140),\,\mathbf{p}_{\Gamma_4}:=(20,140).
\end{equation}

The covering problem can be solved using the paths in \frefeq{eq:basic-plan}, the triggering points in \frefeq{eq:basic-plan-trigs}, the remaining paths $\varphi_5,\varphi_6,\dots,\varphi_l$, and triggering points $\mathbf{p}_{\Gamma_5},\mathbf{p}_{\Gamma_6},\dots,\mathbf{p}_{\Gamma_l}$ defined similarly to \frefeqM{eq:basic-plan}{eq:basic-plan-trigs}.

A generic solution for the covering problem is then defined with the paths
\begin{subequations}\label{eq:line-gene}\begin{align}
  \varphi_i(\mathbf{p}(t))&:=x-x_{\Gamma_1}-\lfloor i/4\rfloor x_d,\\
  \varphi_{i+2}(\mathbf{p}(t))&:=x-x_{\Gamma_2}-\lfloor i/4\rfloor x_d,
\end{align}
\end{subequations}
$\forall i\in\{1,5,9,\dots,l-3\}$ ($i$ is used to iterate all the paths up to the last path $\varphi_l$), $x_d$ is a shift on the $x-$axis, $\lfloor i/4\rfloor$ is the integer division. The expressions in \frefeq{eq:line-gene} correspond to the generalizations of the lines in \frefeq{eq:line1} and \frefeq{eq:line2}. The generalizations of the circles in \frefeq{eq:circ1} and \frefeq{eq:circ2} are
\begin{subequations}\begin{align}
  \varphi_{i+1}(\mathbf{p}(t))&:=(x-x_{\Gamma_1}-r_1-\lfloor i/4\rfloor x_d)^2+(y-y_{\Gamma_1})^2-r_1^2,\\
  \varphi_{i+3}(\mathbf{p}(t))&:=(x-x_{\Gamma_2}+r_2-\lfloor i/4\rfloor x_d)^2+(y-y_{\Gamma_3})^2-r_2^2,\label{eq:second-circ-gene}
\end{align}
\end{subequations}
where index $i$ is defined the same way as in \frefeq{eq:line-gene} along the shift and integer division. $r_1$ and $r_2$ are given radiuses of the circles $\varphi_2$ and $\varphi_4$ (see \fref{fig:plot4}{Figure}).

The triggering points can be expressed similarly with the expressions
\begin{subequations}\label{eq:trigs-gene}\begin{align}
  \mathbf{p}_{\Gamma_i}&:=(x_{\Gamma_1}+\lfloor i/4\rfloor x_d,y_{\Gamma_1}),\\
  \mathbf{p}_{\Gamma_{i+1}}&:=(x_{\Gamma_1}+2r_1+\lfloor i/4\rfloor x_d,y_{\Gamma_1}),\\
  \mathbf{p}_{\Gamma_{i+2}}&:=(x_{\Gamma_1}+2r_1+\lfloor i/4\rfloor x_d,y_{\Gamma_3}),\\
  \mathbf{p}_{\Gamma_{i+2}}&:=(x_{\Gamma_1}+2r_1-2r_2+\lfloor i/4\rfloor x_d,y_{\Gamma_3})\label{eq:last-trig-gene}.
\end{align}
\end{subequations}

We note from \fref{fig:plot4}{Figure} and \frefeqM{eq:line-gene}{eq:trigs-gene} that $y_{\Gamma_3}-y_{\Gamma_1}$ is the height of the polygon to be covered, $2(r_1-r_2)$ the distance between the covering lines (which is equal to the shift $x_d$), and $lx_d/4$ is the length of the polygon.

The plan in \frefeqM{eq:line-gene}{eq:trigs-gene} is static. There is no path parameter that allows to alter the plan. We can easily transform such plan with the addition of a path parameter $c_{4,1}$ relative to the radius of the second circle $\varphi_4$ in \fref{fig:plot4}{Figure}
\begin{equation}\label{eq:radius-dynamic}
  r_2(c_{4,1}):=(r-c_{4,1}),
\end{equation}
where $r<r_1$ is a given constant initial radius.

We note from the expression in \frefeq{eq:radius-dynamic} that \frefeq{eq:last-trig-gene} and \frefeq{eq:second-circ-gene} depend on the parameter $c_{4,1}$ (they contain $r_2$, which depend on $c_{4,1}$). They can be thereby dynamically replanned, resulting in an alteration of the quality of the coverage. They indeed change the distance between the survey lines.

We can bound the alteration (see \fref{def:stage}{Definition}) with $\mathcal{C}_{4,1}:=[\underline{c}_{4,1},\overline{c}_{4,1}]$. 

The concept is illustrated in \fref{fig:plot5}{Figure}. The black line is the un-altered path, the dashed blue line the replanned path. The gray area delimits the bound $\mathcal{C}_{4,1}$. The alteration of the plan using path parameter $c_{4,1}$ shortens or extends the flying time.

\begin{figure}[p!]
  \centering
  \input{figures/plot5.tikz}
  \caption[Alteration of a path parameter of the fixed-wing aerial robot's plan]{Alteration of a path parameter of the fixed-wing aerial robot's plan in \fref{fig:plot4}{Figure}. The black line is the un-altered path, the dashed blue line the altered path. The gray area delimits the bound $\mathcal{C}_{4,1}$. The alteration changes the distance between the survey lines hence extending or shortening the flying time. The figures show the concept for the path parameter $c_{4,1}$. Same principle applies to path parameter $c_{8,1}$ for the next two survey lines, $c_{12,1}$, and so on.}
  \label{fig:plot5}
\end{figure}

Since the last path $\varphi_4$ is a function of the parameter $c_{4,1}$, the correct expression for \frefeq{eq:second-circ-gene} is 
\begin{equation}
  \varphi_{i+3}(\mathbf{p}(t),c_{4,1}):=(x-x_{\Gamma_2}+r_2(c_{4,1})-\lfloor i/4\rfloor x_d)^2+(y-y_{\Gamma_3})^2-r_2(c_{4,1})^2.
\end{equation}

The last triggering point $\mathbf{p}_{\Gamma_4}$ of the example in \frefeq{eq:last-trig-gene} is likewise a function of the parameter $c_{4,1}$
\begin{equation}
  \mathbf{p}_{\Gamma_{i+2}}:=(x_{\Gamma_1}+2r_1-2r_2(c_{4,1})+\lfloor i/4\rfloor x_d,y_{\Gamma_3})
\end{equation}
as it depends on the radius $r_2$ of the circle $\varphi_4$. The same applies to all the following functions $\varphi_5,\varphi_6,\varphi_7$, since these are all a function of the triggering point $\mathbf{p}_{\Gamma_4}$. The path $\varphi_8$ is then a function of the parameter $c_{4,1}$ and $c_{8,1}$ propagating the parameters for all the following paths $\varphi_9,\varphi_{10},\varphi_{11}$ and so on.

\subsection{Mobile robot planning problem}
\label{sec:plan-pb}

In order to simplify the problem formulation, we consider some primitive paths. All the other paths are built from these paths with a shift $\mathbf{d}:=(x_d,y_d)$.

Given $n\in\mathbb{Z}_{>0}$ ($n<l,l/n\in\mathbb{Z}$) primitive paths $\varphi_1,\dots\varphi_n$, a generic starting point $\mathbf{p}(t_0)$ at the initial time $t_0$, and the current levels of the path parameters $c_1^\rho$, all the other paths $\varphi_{n+1},\dots,\varphi_l$ are built
\begin{equation}\label{eq:primitive}\begin{split}
  &\varphi_{(i-1)n+j}(\mathbf{p}+(i-1)\mathbf{d},c_1^\rho)-\\ &\,\,\,\varphi_{in+j}(\mathbf{p}+i\mathbf{d},c_1^\rho)=e_j,
\end{split}\end{equation}
$\forall i\in[l/n-1]^+,j\in[n]^+$, where $e_j\in\mathbb{R}$ is the $j$-th constant difference.

\begin{highlight}
\begin{defn}[Period]\label{def:period}
  The period $T\in\mathbb{R}_{> 0}$ is the time between $\varphi_{(i-1)n+j}$ and $\varphi_{in+j}$ in \frefeq{eq:primitive}.
\end{defn} 
\end{highlight}

The algorithm measures the time between the paths and assumes the initial period is one. The periods might be different for different $j$s due to atmospheric interferences.

One can define the plan using primitive paths or define all the stages explicitly and find $n$ searching the value which satisfies the \frefeq{eq:primitive}. If there is no such value, (e.g., when the plan is composed of only one stage), the period $T$ from \fref{def:period}{Definition} can be determined empirically from energy data. We discuss the period estimation further in \fref{sec:period-est}{Section}.

\begin{highlight}
\begin{pb}[Mobile robot planning problem]\label{pb}
  Consider an initial plan $\Gamma$ from \fref{def:stage}{Definition}. We are interested in the planning of the path and computation parameters $c_i,\,\forall i\in[l]^+$ under energy constraints and uncertainty.
  
We are further interested in the guidance to the path and the scheduling of the computations resulting from such planning.
\end{pb}    
\end{highlight}

\section{Structure}
\label{sec:structure}

The remainder of this work is structured as follows.

In this chapter, we presented the mobile robot planning problem. We propose the solution to the problem in \fref{cp:opt}{Chapter}, which builds upon the topics presented in the remaining chapters.

In particular, in \fref{cp:soa}{Chapter} we present the state-of-the-art in energy modeling and planning for mobile robots. We include some energy models for heterogeneous computing hardware.

Dynamic planning requires accurate future energy predictions. We present the derivation of some energy models to address future energy predictions in \fref{cp:model}{Chapter}. Specifically, we propose energy models for computations, motion, and the battery. We derive and formally prove a periodic energy model that we use in the remainder of this work to predict future energy consumption.

The periodic energy model's accuracy depends on the availability of measurements of energy data. We detail the process in \fref{cp:est}{Chapter}. We describe how to estimate the coefficients of the periodic energy model and refine the future predictions with the available data.

Flying on a dynamic plan requires the derivation of a guidance action to guide the aerial robot in space. This process is elaborated in \fref{cp:gd}{Chapter}. We discuss an approach to guide the aerial robot in space on the planned path.

An optimal solution for the dynamic mobile robot planning problem relies on optimal control techniques. We describe such techniques in \fref{cp:opt}{Chapter}. Specifically, after summarizing some of these techniques, we propose an optimization algorithm to select the optimal parameters configuration for the path and computations simultaneously.

Finally, we conclude our work in \fref{cp:conc}{Chapter} along some recommendations for future research direction.

We then present some additional information in appendices.

In \fref{app:imp}{Appendix} we propose the implementation in MATLAB(R) of the planning problem, the model, the estimation technique, the guidance action, and the derivation of the optimal control. 

