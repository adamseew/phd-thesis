
%%%%%%%%%%%%%%%%%%
%                %
% Introduction   %
%                %
\chapter{Introduction}
\label{cp:intro}

%\begin{highlight}
%    \begin{st}
%        General structure with just some dummy text.
%    \end{st} 
%\end{highlight}

\lettrine{M}{obile robots} are a class of robots with the ability to move through the environment~\citep{corke2017robotics}. Most of these robots are power-demanding devices constrained by battery limitations. Whilst such limitations are a common challenge in many areas, they are critical in mobile robots' design and development. They influence the level of autonomy~\citep{seewald2020mechanical}, which in turn is expected to increase in the foreseeable future~\citep{fisher2013verifying}.

To move, mobile robots combine different components which sense and interact with the surrounding environment~\citep{mei2006deployment}. The analysis and interpretation of data originating from these components require energy-demanding heterogeneous computing hardware. Planning an energy-aware path with a power-saving scheduling policy on such hardware is an underrepresented topic in the literature. In fact, many past approaches focus almost exclusively on one of these topics. For instance, some approaches generate an energy-optimized path, despite the energy needed for the computations almost equaling the actuation of some instances of low-energy mobile robots~\citep{sudhakar2020balancing}. Due to the recent advancements in the computational capabilities of mobile hardware, such as the introduction of powerful portable GPUs\findex{GPU}~\citep{rizvi2017general}, the use of computations is expected to increase~\citep{abramov2012real,satria2016real,jaramillo2019visual}. Other approaches provide a power-saving scheduling policy. Yet, actuating a mobile robot requires considerable power over mere calculations~\citep{mei2004energy,mei2005case}.

In this work, we focus on dynamic energy planning by generating an energy-aware plan of the path and a power-saving schedule of the computational tasks. We generate these two aspects simultaneously, exploring their tradeoffs. We demonstrate the approach both in simulation and empirically focusing on aerial mobile robots. These systems share with the broader class of mobile robots very stringent battery limitations. Recharging the battery during normal operation is, however, rarely an option for aerial robots. It would require landing to replace or recharge the battery~\citep{zamanakos2020energy}. They are hence a perfect instance of energy-constrained systems and are the main focus of our analysis.

To achieve dynamic energy planning, we first formulate some autonomous operations for mobile robots that we are studying in \fref{sec:pb-form}{Section}. Such operations often originate from mobile robotics use-case as precision agriculture, search and rescue, payload delivery, transportation, and many others. We focus on the first two applied to the aerial robotics context. We then build an energy model to predict future energy consumption in \fref{cp:model}{Chapter}. We estimate the coefficients of the model using robust estimation techniques in \fref{cp:est}{Chapter}. Later, we derive an optimal configuration of the path and computations use data-driven control\findex{data-driven control} and other modern optimal control techniques in \fref{cp:opt}{Chapter}. Here some estimates are made from sensors' data and used to derive an optimal control action. We use such optimal control for guidance and scheduling of the aerial robot in \fref{cp:gd}{Chapter}. The guidance moves physically the robot; the scheduling defines the granularity of the tasks being executed in flight.

\begin{figure}[t]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/photo}
  \caption[Opterra fixed-wing drone]{Opterra fixed-wing drone employed as an aerial robotics platform for precision agriculture {\scriptsize(photo credit: Amit Ferencz Appel)}.}   
  \label{fig:opterra}
\end{figure}

We investigate different physical mobile robotics platforms in this work but we focus most on the Opterra fixed-wing drone\findex{Opterra fixed-wing drone}~\citep{opterra} adapted for precision agriculture. Precision agriculture\findex{precision agriculture} is often put into practice~\citep{hajjaj2014review} with ground mobile robots used for harvesting~\citep{qingchun2012study,dong2011development, de2011design, aljanobi2010setup, li2008analysis, edan2000robotic}, and \Gls{acr:uav}s for preventing damage and ensuring better crop quality~\citep{puri2017agriculture, daponte2019review}. The aerial robot is shown in \fref{fig:opterra}{Figure}.

In the remainder of the chapter and before we introduce the problem in \fref{sec:pb-form}{Section}, we briefly investigate the evolution of the field of aerial robotics in the next section. We then analyze the main aerial robots available today, and how they apply to dynamic energy planning in \fref{sec:aerial-robo-types}{Section}. We then provide some further motivation for such planning in \fref{sec:motivation}{Section} and an outline of the approach in \fref{sec:outline}{Section}. Finally, we provide the structure of the remaining chapters in \fref{sec:structure}{Section}.

\section{From UAVs to Modern Aerial Robots}

Modern aerial robots are a valuable tool in robotic research and aerospace. They can be found with different names in the literature. These include unmanned aerial vehicles\findex{unmanned aerial vehicles} (\Gls{acr:uav}s)\footnote{The term unmanned is sometimes replaced by uninhabited if the vehicle is operated remotely by human operator}%citation to Anderson
, unmanned aerial systems\findex{unmanned aerial systems} (\Gls{acr:uas}s), flying robots, or drones. Usually, we refer to drones, \Gls{acr:uav}s, and \Gls{acr:uas}s when these systems are semi-autonomous, or operated from the ground. \Gls{acr:uas} often denote the entire infrastructure of unmanned flight in the aerospace jargon. Aerial or flying robots, on the other hand, have advanced levels of autonomy~\citep{siciliano2016springer}. Nevertheless, all these systems have basic autonomous features such as position and altitude holding, and leveling. The position holding is usually implemented using global navigation satellite system\findex{global navigation satellite system} (\Gls{acr:gnss}), altitude holding using a barometer\findex{barometer}, and leveling using inertial measurement unit\findex{inertial measurement unit} (\Gls{acr:imu}).

\begin{figure}[t]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/HA-NH-JA-19_1}
  \caption[Hewitt-Sperry Automatic Airplane, first unmanned flying machine]{The Hewitt-Sperry Automatic Airplane also denominated ``flying bomb'' was developed in WWI and represents the first instance of a \Gls{acr:uav} {\scriptsize(photo credit: United States Naval Institute)}.}   
  \label{fig:hewitt-sperry}
\end{figure}

Uninhabited or unmanned flight has more than a century of developments~\citep{siciliano2016springer}. The origin of the field of aerial robotics, which deals with the design and development of aerial robots, dates back to the first guided missiles~\citep{siciliano2016springer}. Hewitt-Sperry Automatic Airplane\findex{Hewitt-Sperry automatic airplane} developed in 1917 during World War I\findex{World War I} (WWI)~\citep{keane2013brief,valavanis2015handbook} is often referred to as the first unmanned flying machine; a milestone reached relatively soon if we consider that the first heavier-than-air flight in history was demonstrated 14 years earlier with the Wright Flyer I by Wilbur and Orville Wright\findex{Wright brother} (or the Wright brothers). The Hewitt-Sperry Automatic Airplane used a gyroscope\findex{gyroscope}, invented by Elmer Sperry~\citep{keane2013brief}, mechanically connected to the control surfaces and thus successfully integrating a control feedback loop~\citep{siciliano2016springer}. It is shown in \fref{fig:hewitt-sperry}{Figure}.

In the early days, these flying machines were labeled remotely piloted vehicles\findex{remotely piloted vehicles} (\Gls{acr:rpv}s)~\citep{anderson2005introduction}. Many instances from WWI on of such early \Gls{acr:uav}s were designed for military purposes. In the 1950s, United States used a remotely controlled vehicle Ryan Firebee~\findex{Ryan Firebee} for reconnaissance in Vietnam, and Israel used first a \Gls{acr:rpv} in a combat situation~\citep{anderson2005introduction}. Other instances of these vehicles include the V-1 flying bomb~\findex{V-1 flying bomb} from 1944 (deployed by the unified armed forces of nazi Germany) and the Lockheed D-21~\findex{Lockheed D-21} from 1962 (deployed by the United States Air Force).

Global positioning system\findex{global positioning system} (\Gls{acr:gps}) at the end of 1970 opened the possibility for using the \Gls{acr:uav}s for autonomous surveillance, and later integrate them with cameras~\citep{siciliano2016springer}, paving the introduction of modern \Gls{acr:uav}s.

In recent years unmanned flight has been applied in many civilian applications~\citep{gonzalez2017unmanned}. Modern aerial robots are increasingly used in remote sensing\findex{remote sensing}~\citep{noor2018remote,tang2015drone,milas2018drones}, surveillance\findex{surveillance}~\citep{paucar2018use,burkle2009collaborating}, meteorology\findex{meteorology}~\citep{schuyler2019using}, search and rescue\findex{search and rescue}~\citep{pensieri2020drones,karaca2018potential,cui2015drones,seguin2018unmanned}, precision agriculture~\citep{daponte2019review,puri2017agriculture}, transportation, and payload delivery\findex{payload delivery}~\citep{kellermann2020drones}. Although the former four categories do not need advanced autonomy and they fall into the area of reconnaissance, surveillance, and target acquisition\findex{reconnaissance, surveillance, and target acquisition} (\Gls{acr:rsta}), agriculture, transportation, and payload delivery are often realized using to a greater or lesser extent some advanced levels of computational intelligence~\citep{siciliano2016springer}. 

Modern aerial robots are designed to handle unexplored terrain with little interaction as opposed to past \Gls{acr:uav}s operated mainly by a human operator~\citep{siciliano2016springer}. Instances of these systems are in fact expected to autonomously adapt and possibly interact in a broad variety of environmental conditions. 

We conclude this section with a quote from~\citep{anderson2005introduction}: ``the Wright brothers worked so hard to put humans in the air in flying machines, a hundred years later some [...] are working hard to take them out of flying machines''.


\section{Common Classes of Aerial Robots}
\label{sec:aerial-robo-types}

Numerous different types of aerial robots have emerged ever since their first introduction. We briefly investigate the most studied classes in the robotics literature and relate them to the dynamic energy planning that we focus on in this work. 

The two most generic classes are heavier-than-air and lighter-than-air aerial robots.

Heavier-than-air aerial robots\findex{heavier-than-air aerial robots} are divided into fixed- and rotary-wings~\citep{siciliano2016springer}. Some recent developments in bio-inspired robotics study flapping-wings~\citep{floreano2015science}\findex{flapping-wings}. We discuss in detail heavier-than-air aerial robots in this work, as they are a common platform for robotics research. 

Rotary-wing aerial robots\findex{rotary-wings} are highly maneuverable and can perform stationary vertical flight (commonly referred to as hovering\findex{hovering})~\citep{siciliano2016springer}. These systems can be classified into further categories, which include multirotors\findex{multirotors} (such as quadrotors\findex{quadrotors} or quadcopters\findex{quadcopters}, hexacopters\findex{hexacopters}, and octocopters\findex{octocopters}), conventional helicopters\findex{helicopters} (these have one main and one tail rotor), and a coax\findex{coax} (these have counter-rotating coaxial rotors)~\citep{corke2017robotics}.

Fixed-wing aerial robots\findex{fixed-wings} have wings to provide the lift, some control surfaces for maneuvering, and a propeller for forwarding thrust; a shared principle with a common passenger aircraft~\citep{corke2017robotics}. An example constitutes the Opterra adapted for precision agriculture in \fref{fig:opterra}{Figure}.

We discuss the dynamic forces which govern the flight of rotary and fixed-wing aerial robots in \fref{cp:gd}{Chapter}.

Common instances of lighter-than-air aerial robots\findex{lighter-than-air aerial robots} are blimps\findex{blimps} (or non-rigid airships). They usually rely on a gas--such as helium enclosed in a protected envelope~\citep{burri2013design}--to generate the lifting force~\citep{fui2017recent}. An omnidirectional spherical blimp is shown in \fref{fig:skye-blimp}{Figure}. Blimps are similar to balloons but provide basic maneuverability, whereas, in a balloon, only the altitude can be controlled~\citep{colombatti2011lighter}.

\begin{figure}[h]
  \centering
  \includegraphics[width=.7\textwidth]{pictures/IMG_2612}
  \caption[Skye, an omnidirectional spherical blimp]{Skye, an omnidirectional spherical blimp developed by ETH Z\"urich. Developed for entertainment purposes, it has a camera system and combines the energy-efficient flight of a blimp with the characteristics of a quadrotor {\scriptsize(photo credit: ETH Z\"urich)}.}   
  \label{fig:skye-blimp}
\end{figure}

Some other classifications found in aerial robotics literature often rely on size and maneuverability and include micro aerial vehicles (MAVs)\findex{micro aerial vehicles}. These are aerial robots with all dimensions lower than 15 cm. Vertical take-off and landing (VTOLs)\findex{vertical take-off and landing} are aerial robots flying in a fixed-wing configuration except if taking-off and landing where they use thrust from rotors rather than lift from wings. 

While rotary-wings are the most maneuverable, less-than-air aerial robots are the least. These, however, have the highest endurance followed by fixed-wing aerial robots. Flapping-wings and mixed configurations, such as VTOLs, fall into the intersection of rotary and fixed-wings for what concerns maneuverability and endurance~\citep{siciliano2016springer}. The energy requirements are critical for all aerial robots, but the difference of motion and computation energy (\Gls{acr:mace}) varies greatly. The energy--inversely proportional to endurance--is highest in rotary-wings and lowest in lighten-than-air aerial robots. The dynamic energy planning approach thus relies on both power-saving task scheduling and energy-efficient path planning for the fixed-wings robots while relying almost exclusively on energy-efficient path planning for rotary-wing aerial robots. In the former \Gls{acr:mace} is close to zero, in the latter is usually high except in energy optimized designs such as some rotary-wing MAVs. Hypothetically, in lighter-than-air aerial robots, \Gls{acr:mace} might be negative; the energy planning approach would rely heavily on power-saving task scheduling.


\section{Motivation}
\label{sec:motivation}

Many applications that involve mobile robots have strict battery limitations. Although this is a common problem to almost any mobile robot, aerial robots are particularly affected. To overcome physical limitations they generally would have to land to recharge or replace the battery~\citep{zamanakos2020energy}. The autonomy of these systems is consequently affected by the availability of the power source. 

A typical example of an aerial robotics scenario in this situation is a robot following a path and performing some onboard computational tasks. For instance, the robot might detect ground patterns and notify other ground-based actors with little human interaction in precision agriculture or another autonomous scenario.

A further complication in these scenarios is that autonomous mobile robots usually carry energy-demanding heterogeneous computing hardware\findex{heterogeneous computing hardware} along a microcontroller\findex{microcontroller} used for basic motion. Computing hardware is involved in path planning and enables autonomous functions, opposed to the microcontroller. The latter runs motion primitives by directly interfacing actuators (such as servos\findex{servo} for the control surfaces\findex{control surface} and motors\findex{motor} for the thrust\findex{thrust} of a fixed-wing aerial robot). The former runs often computer vision and other complex algorithms.

For certain classes of aerial robots with \Gls{acr:mace} close or lower than zero, the autonomy can directly influence the battery state. It is, however, uncommon to find a ready-to-use solution for planning both the path and scheduling the computations of these systems in an energy-aware fashion (we discuss in detail the state-of-the-art in this regard in \fref{cp:soa}{Chapter}). Planning these two aspects simultaneously would pose an advantage in terms of autonomy by optimizing both the path and computations in the function of the battery state of charge (\Gls{acr:soc}). 

Moreover, it is often desirable to reschedule the computations in an energy-aware fashion in-flight phases when the energy needed for motion is different from expected. For instance, a fixed-wing aerial robot might be flying headwinds (with the wind vector parallel and opposite to the direction of motion) and utilizing more energy than planned. It would be of advantage to reschedule the tasks accordingly to save energy needed for motion. During the same flight, the wind direction might suddenly change. The fixed-wing craft, now flying tailwinds, utilizes less energy. It could then potentially increase the level of computations by rescheduling the tasks. In the same flight, the battery might be subject to sudden drops (due to e.g., temperature changes) requiring again replanning by, for instance, shortening the path. It is clear that planning the path and scheduling the computations simultaneously in this scenario is the most desirable course of action.

\subsection{Motion and computation energy}

In the remainder of this work, we refer to computational tasks that can be scheduled in an energy-aware fashion as \emph{computations}, opposed to the other tasks that have no significant effect on energy consumption.

\begin{highlight}
  \begin{defn}[Computations]
    Computations are computational tasks executed on energy-demanding heterogeneous computing hardware carried by a mobile robot along with microcontrollers, sensors, and actuators.
  \end{defn}
\end{highlight}

As an example, we use an aerial robot detecting some patterns while logging the position. Detecting the patterns usually involves heterogeneous computing elements (GPU\findex{GPU} and/or multiple CPU\findex{CPU} cores) and consumes a significant amount of energy as opposed to the log of the position. Detection is a computation, while a log script is (an energy-inexpensive) task.

We refer to the energy that the computations consume as the computation energy, opposed to the motion energy used for physical motion. We use the terms computation and motion energy, and \Gls{acr:mace} several times in the remainder of this work. We thus define these terms formally.

\begin{highlight}
\begin{defn}[Computation/motion energy, \Gls{acr:mace}]
  Given a schedule composed of $i$ computations $s:=\{s_1,s_2,\dots,s_i\}$, the computation energy $E_s(s)$ is the energy spent by heterogeneous computing hardware while executing $s$.
  
  The motion energy is the remaining $E_m$ energy the mobile robot utilizes for the physical motion, for sensing, and for actuating.
\end{defn}
\end{highlight}

Computation and motion energy is measured in watts if instantaneous or joules if over a given time interval.

\begin{highlight}\findex{difference of motion and computational energy}
  \begin{defn}[Difference of motion and computation energy \Gls{acr:mace}]
    The difference of motion and computation energy (\Gls{acr:mace}) is then $E_s-E_m$.
  \end{defn}
\end{highlight}

\subsection{Objective}

We are interested in the energy optimization of the path and computations under uncertainty (atmospheric interferences) in-flight and refer to it as energy dynamic planning.

Such planning would find optimal tradeoffs\findex{tradeoffs} between the path, computations, and energy requirements. Current generic planning solutions for aerial robots do not plan the path and computations dynamically, nor are they energy-aware. They are often semi-autonomous: the path and computations are static and usually defined using planning software~\citep{daponte2019review}. Instances of the planning software include PX4~\citep{px4} and Paparazzi~\citep{papa} flight controllers. Such a state of practice has prompted us to pursue the presented work in dynamic energy planning for aerial robots which plans both the path and computations autonomously while the aerial robot is flying and its batteries draining. 

In our approach, we combined and generalized some of the past body of knowledge on mobile robot planning problems and addressed the increasing computational demands and their relation to energy consumption, path, and autonomy for the mobile robot planning problem. 

We define formally the robot planning problem after outlining the approach in greater detail in the next section.


\section{Outline of the Approach}
\label{sec:outline}

Unlike most of the past mobile robotics planning literature, the approach that we propose plans the path and computations simultaneously. 

The approach necessitates a user-defined initial plan that is replanned energy-wise using the model for future prediction. In the remainder of this work, we progressively build an algorithm that inputs a user-specified initial plan, estimates the model, evaluates future energy consumption, and eventually replans the parameters. 

The initial plan consists of different stages. At each stage, the mobile robot travels a path and executes some computations. The plan then contains some parameters that allow altering the path and computations along with an energy budget.

The alterations are bounded. There is one path constraint set which bounds the path and multiple computation constraint sets, one per each computation parameter, that bound computations.

To model the path we use multiple mathematical functions $\varphi_1,\varphi_2,\dots$. If the path is expressed in 2D at a fixed altitude $h$, the function $\varphi:\mathbb{R}^2\rightarrow\mathbb{R}$ quantifies the distance of a generic point $\mathbf{p}$ in the 2D space from the path. For instance one can define a path as a line
\begin{equation}
  \varphi(x,y):=ax+by+c,
\end{equation}
where $a,b,c$ are given constants. A generic point $\mathbf{p}:=(x_{\mathbf{p}},y_{\mathbf{p}})$ quantifies the distance on the $z$ axis from $ax+by+c=0$. 

\begin{figure}[t]
  \centering
  \input{figures/plot1.tikz}
  \caption[Concept of the path and generic point in space]{If we define the path as mathematical function $\varphi$ at a fixed altitude $h$, a generic point $p$ in 2D space quantifies the distance $d$ on the $z$ axis from $h$.}
  \label{fig:plot1}
\end{figure}

The concept is shown in \fref{fig:plot1}{Figure} for $c$ zero and $a,b$ minus one and two respectively. A generic point $\mathbf{p}:=(x_{\mathbf{p}},y_{\mathbf{p}})$ intersects the plane
\begin{equation}
  \varphi(x,y):=2y-x,
\end{equation}
at $z=\varphi(\mathbf{p})$. The path at a fixed altitude is then $\varphi(x,y)=0$, or more generally $\varphi(x,y)=h$ with $h\in\mathbb{R}$.

We use this concept to model complex paths. For instance, the path might contain multiple circles and lines{\color{red}, as shown in \dots. The aerial robot travels the path using vector field for guidance (we describe in detail such vector field in \fref{cp:gd}{Chapter}) and switches between the trajectories as soon as it reaches specific triggering points}. 

To model the computations we use \powprof{}, a profiling tool presented in~\citep{seewald2019coarse}. To guide the UAV we use a vector field~\citep{de2017guidance} that converges to the path. The use of vector fields for guidance is widely discussed in the literature~\citep{lindemann2005smoothly,gonccalves2010vector,panagou2014motion,zhou2014vector,kapitanyuk2017guiding,de2017guidance}. 

To achieve the energy-aware dynamic planning, we further introduce and formally prove a periodic energy model that accounts for the uncertainty. We use Fourier analysis to derive the model, and state estimation to address the uncertainty. Periodicity is often present due to repetitive patterns in the plan~\citep{seewald2020mechanical}. Indeed, mobile robots often iterate over a set of tasks and paths. Given that the plan is periodic, we expect the energy consumption to approximately evolve periodically. We describe in detail such model in \fref{cp:model}{Chapter}. 

Some collected energy data from the Opterra (\fref{fig:opterra}{Figure}) adapted for precision agriculture along its power spectrum motivates our choice {\color{red}in \dots \fref{}{Figure} and \dots}. 

We replan the path and computations with model predictive control (MPC)~\cite{rawlings2017model}. The control is data-driven. Energy sensor data estimates some coefficients of an energy model used to predict future energy consumption in presence of uncertainty. The energy budget is the battery capacity and other battery parameters. These are fixed values that are not replanned by the algorithm. Our goal is to complete the plan with the highest possible parameters configuration as the mobile robot executes the plan and its batteries drain. 

\subsection{Applications}

The dynamic energy planning in this work applies mostly to modern aerial robots with a certain degree of autonomy in the sense that the aerial robot is assumed to perform a predefined set of tasks over a given space. Although most of the guidance in \fref{cp:gd}{Chapter} is specifically meant for aerial robots, the approach can be easily adapted to other energy-constrained mobile robots. For instance, we have applied the approach to the space robotics context~\citep{seewald2020beyond}. We discuss this further in \fref{cp:conc}{Chapter}.

We specifically focus and show the performance on a search and rescue and precision agriculture scenario implemented with aerial robots. In fact, precision agriculture is often put into practice~\citep{hajjaj2014review} with ground mobile robots used for harvesting~\citep{qingchun2012study,dong2011development, de2011design, aljanobi2010setup, li2008analysis, edan2000robotic}, and aerial robots for preventing damage and ensuring better crop quality~\citep{puri2017agriculture, daponte2019review}. 

In the search and rescue scenario, the aerial robot performs autonomous detections of patterns over the sea. In this scenario, we mostly focus on the validation of the computation energy model (described in detail in \fref{}{}).

In the precision agriculture scenario, the aerial robot covers a given agricultural field (a polygon) and search for ground hazards. The plan is structured as follows. Path-wise, the Opterra fixed-wing drone from \fref{fig:opterra}{Figure} flies in circles and lines covering the polygon. Computation-wise, it detects hazards using a neural network and notifies grounded mobile robots employed for, e.g., harvesting. The approach alters the plan; it controls the processing rate and the radius of the circles affecting the distance between the lines. 

We observe that not only the path but also the computations significantly impact the energy, with a potential extension of up to 13 minutes over an hour by switching from the highest to the lowest level of computations in presence of a standard battery.

\section{Problem Formulation}
\label{sec:pb-form}

To formulate the mobile robot planning problem we adopt to the following mathematical notation. We apply later the formulation to both the search and rescue and the precision agriculture scenario.

Given an integer $x\in\mathbb{Z}_{\geq 0}$, we use the notation $[x]$ for the set $\{0,1,\dots,x\}\subseteq\mathbb{Z}_{\geq 0}$. The notation $[x]_{>0}$ for the set $\{1,2,\dots,x\}\subseteq\mathbb{Z}_{> 0}$ or simply $[x]/\{0\}$ with $x\in\mathbb{Z}_{>0}$. We use bold lower-case letters $\mathbb{x}$ for the vectors.

We use extensively the term parameters. These are variable values that we use to dynamically plan path and computations. $c_{i,j}$ denotes the $j$-th parameter of the $i$-th parameters set $c_i$. $\underline{c}_{i,j}$ is the lower bound of the parameter $c_{i,j}$. $\overline{c}_{i,j}$ is the upper bound of the parameter $c_{i,j}$, i.e., $\underline{c}_{i,j}\leq c_{i,j}\leq\overline{c}_{i,j}$.

Let us assume that the path at stage $i$ can be altered with $\rho$ path parameters
\begin{equation}\label{eq:path-params}
    c_i^\rho:=\{c_{i,1},c_{i,2},\dots,c_{i,\rho}\},
\end{equation}
and the computations with $\sigma$ computation parameters 
\begin{equation}\label{eq:comp-params}
    c_i^\sigma:=\{c_{i,\rho+1},c_{i,\rho+2},\dots,c_{i,\rho+\sigma}\}.
\end{equation}

We then express the path as a continuous twice differentiable function $\varphi_i:\mathbb{R}^2\times\mathbb{R}^\rho\rightarrow\mathbb{R}$ of a point and the path parameters. The function returns a metric of the distance between the point and the nominal trajectory. We express the computations as the value of the computation parameters. We discuss the concrete meaning of the value of path parameters in \fref{cp:model}{Chapter}.

\begin{highlight}  
  \begin{defn}[Stage]\label{def:mission}
    The $i$-th \emph{stage} $\Gamma_i$ at time instant $t$ of a plan $\Gamma$ is
    \begin{equation*}\begin{split}
      \Gamma_i:=\{\varphi_i(\mathbf{p}(t),c_i^\rho),c_i^\sigma\mid
      \,&\exists\,\,\mathbf{p}(t),\,\varphi_i(\mathbf{p}(t),c_i^\rho)\in\mathcal{C}_i,\,\\
        &\,\forall j\in[\sigma]^+,\,c_{i,\rho+j}\in\mathcal{S}_{i,j}\,\},
    \end{split}\end{equation*}
    where $\mathcal{C}_i:=[\underline{c}_i,\overline{c}_i]\subseteq\mathbb{R}$ is the path constraint set, and $\mathcal{S}_{i,j}:=[\underline{c}_{i,\rho+j},\overline{c}_{i,\rho+j}]\subseteq\mathbb{Z}_{\geq 0}$ the $j$-th computation constraint set. 
    
    $\mathbf{p}(t)$ is a point of a mobile robot travelling at an altitude $h\in\mathbb{R}_{\geq 0}$ with respect to some inertial navigation frame $\mathcal{O}_W$.
  \end{defn}
\end{highlight}

\begin{highlight}  
  \begin{defn}[Plan]
    The \emph{plan} is a finite state machine (FSM) $\Gamma$ where the state-transition function $s:\bigcup_i{\Gamma_i}\times\mathbb{R}^2\rightarrow\bigcup_i{\Gamma_i}$ maps a stage and a point to the next stage
    \begin{equation*}s(\Gamma_i,\mathbf{p}_k):=\begin{cases}
      \Gamma_{i+1} & \text{if }\mathbf{p}_k=\mathbf{p}_{\Gamma_i}\\
      \Gamma_i & \text{otherwise}
    \end{cases}.\end{equation*}
  \end{defn}
\end{highlight}

\begin{highlight}  
  \begin{defn}[Triggering, and final point]\label{def:mission}
    The point $\mathbf{p}_{\Gamma_{i}}$ that allows the transition between $\Gamma_i$ and $\Gamma_{i+1}$ is called \emph{triggering point}. The last triggering point $\mathbf{p}_{\Gamma_{l}}$ relative to the last stage $\Gamma_l$ is called \emph{final point}.
  \end{defn}
\end{highlight}

\begin{figure}[h]
  \center
  \begin{tikzpicture}[shorten >=.5pt,node distance=12.5ex,on grid,auto,initial text=\footnotesize\fontfamily{phv}\selectfont{start}]
    \node[state,initial] (q_i) {$\Gamma_1$}; 
    \node        [right=of q_i] (q_dots0) {$\cdots$};
    \node[state] (q_0) [right=of q_dots0] {$\Gamma_i$};
    \node        (q_dots1) [right=of q_0] {$\cdots$};
    \node[state,accepting] (q_f) [right=of q_dots1] {$\Gamma_f$};
    \path[->]
    (q_i) edge node {$\mathbf{p}_{\Gamma_{1}}$} (q_dots0)
    (q_dots0) edge node{$\mathbf{p}_{\Gamma_{i-1}}$} (q_0)
    (q_0) edge node {$\mathbf{p}_{\Gamma_i}$} (q_dots1)
    (q_dots1) edge node {$\mathbf{p}_{\Gamma_{l}}$} (q_f)    
    (q_i) edge [loop above] node {$\mathbf{p}_{k_1}$} (q_i)
    (q_0) edge [loop above] node {$\mathbf{p}_{k_2}$} (q_0)
    (q_f) edge [loop above] node {$\mathbf{p}_{k_3}$} (q_f)
    ; %end path 
    \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=10pt},yshift=0pt]
    (q_i.south west) -- (q_f.south west) node [black,midway,yshift=-9ex]{$\Gamma$};
  \end{tikzpicture}
  \caption{The plan defined as a FSM}
  \label{fig:state-machine}
\end{figure}

\begin{figure}[t]
    \centering
    \input{figures/traj1.tikz}
    \caption[Definition notation on a slice of the plan]{Definition notation shown on an slice of the plan.}
    \label{fig:traj1}
\end{figure}

The altitude $h$ from \fref{def:mission}{Definition} might change at different flying phases and under different atmospheric conditions

In \fref{fig:traj1}{Figure}, $\varphi_1,\dots,\varphi_6$ are paths. $\varphi_1$ and $\varphi_5$ are circles, while $\varphi_2$, $\varphi_4$, and $\varphi_6$ are lines. They are all relative to different stages $\Gamma_1,\Gamma_2,\dots$. The constraints set $\mathcal{C}_1,\mathcal{C}_2,\dots$ forms the area where the paths $\varphi_1,\varphi_2,\dots$ can be altered with the parameters $c_{i,1},\dots,c_{i,\rho}$ (gray area in the figure). This area is bounded by $\underline{c}_i,\overline{c}_i$, and can be different per each stage \fref{fig:traj1}{Figure}, the area relative to $\Gamma_4$ is bounded by $\underline{c}_4,\overline{c}_4$).

In \fref{fig:traj1}{Figure}, $\mathbf{p}_{\Gamma_1}$ allows the transition between $\Gamma_1$ and $\Gamma_2$, $\mathbf{p}_{\Gamma_4}$ between $\Gamma_4$ and $\Gamma_5$, and $\mathbf{p}_{\Gamma_5}$ between $\Gamma_5$ and $\Gamma_6$.

A slice of the plan in \fref{fig:state-machine}{Figure} shows the transition between the stages with the FSM. The triggering point $\mathbf{p}_{\Gamma_{i-1}}$ allows the transition to the stage $\Gamma_i$. The robot remains in the stage with any generic point $\mathbf{p}_{k_2}$. It eventually enters the stage $\Gamma_{i+1}$ with the triggering point $\mathbf{p}_{\Gamma_i}$ and so on, until it reaches the final point. The stage $\Gamma_f$ is the accepting stage (it indicates that the robot has completed the plan).

\begin{figure}[h]
  \center
  \begin{tikzpicture}[shorten >=1pt,node distance=27ex,on grid,auto]
    \node        (q_dots0) {$\cdots$};
    \node[state] (q_0) [right=of q_dots0] {$\Gamma_i$};
    \node        (q_dots1) [right=of q_0] {$\cdots$};   
    \path[->]
    (q_dots0) edge node{$\mathbf{p}_{\Gamma_{i-1}}(c_1^\rho,\dots,c_{i-1}^\rho)$} (q_0)
    (q_0) edge node {$\mathbf{p}_{\Gamma_i}(c_1^\rho,\dots,c_{i}^\rho)$} (q_dots1)    
    (q_0) edge [loop above] node {$\mathbf{p}_{k}$} (q_0)
    ; %end path
  \end{tikzpicture}
\caption[Detail of a stage in the FSM]{Detail of the stage $\Gamma_i$ in the FSM}
\label{fig:state-machine2}
\end{figure}
    
Generally, one can express the triggering points in function of the $i$-th trajectory parameters $c_{i}^{\rho}$, or any previous trajectory parameters, propagating the information therein if necessary (see \fref{fig:state-machine2}{Figure}).
   

\subsection{Mobile robot planning problem}

In order to simplify the problem formulation, we consider some primitive paths. All the other paths are built from these paths with a shift $\mathbf{d}:=(x_d,y_d)$.

Given $n\in\mathbb{Z}_{>0}$ ($n<l,l/n\in\mathbb{Z}$) primitive paths $\varphi_1,\dots\varphi_n$, a generic starting point $\mathbf{p}$ and the current levels of the path parameters $c_1^\rho$, all the other paths $\varphi_{n+1},\dots,\varphi_l$ are built
\begin{equation}\label{eq:primitive}\begin{split}
  &\varphi_{(i-1)n+j}(\mathbf{p}+(i-1)\mathbf{d},c_1^\rho)-\\ &\,\,\,\varphi_{in+j}(\mathbf{p}+i\mathbf{d},c_1^\rho)=e_j,
\end{split}\end{equation}
$\forall i\in[l/n-1]^+,j\in[n]^+$, where $e_j\in\mathbb{R}$ is the $j$-th constant difference.

\begin{highlight}
\begin{defn}[Period]\label{def:period}
  The period $T\in\mathbb{R}_{> 0}$ is the time between $\varphi_{(i-1)n+j}$ and $\varphi_{in+j}$ in \frefeq{eq:primitive}.
\end{defn} 
\end{highlight}

The algorithm measures the time between the paths and assumes the initial period is one. The periods might be different for different $j$s due to atmospheric interferences.

One can define the plan using primitive paths or define all the stages explicitly and find $n$ searching the value which satisfies the \frefeq{eq:primitive}. If there is no such value, (e.g., when the plan is composed of only one stage), the period $T$ from \fref{def:period}{Definition} can be determined empirically from energy data.

\begin{highlight}
\begin{pb}[Aerila robot planning problem]\label{pb}
  Consider an initial plan $\Gamma$ from \fref{def:mission}{Definition}. We are interested in the planning of the parameters $c_i,\,\forall i\in[l]^+$ and energy constraints and in the guidance of the aerial robot to the path resulting from such plan.
\end{pb}    
\end{highlight}

\section{\color{red}Structure}
\label{sec:structure}

