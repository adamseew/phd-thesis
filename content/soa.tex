
%%%%%%%%%%%%%%%%%%%%%%
%                    %
% State of the Art   %
%                    %
\chapter{State of the Art}
\label{cp:soa}

In this chapter, we discuss the state of the art in dynamic energy planning for autonomous aerial robots. Generally, planning algorithms in robotics center around robot motion planning and deal with problems such as swarms, dynamics, and uncertainty~\citep{lavalle2006planning}. Although there are several contributions applied to a variety of mobile robots, we primarily focus on the literature with the objective of planning dynamically the path along with the computations. We especially emphasize approaches applied to aerial robots with energy constraints operating in coverage problems. To this end, we split the chapter into multiple sections and replicate our workflow throughout the topic. Initially, we analyzed some contributions that quantify the energy consumption of computing hardware carried by mobile robots. Modeling the energy of these devices has laid the foundation for our dynamic energy planning. In \fref{sec:soa-ene-mod}{Section}, we report our findings. We then briefly discuss some approaches for motion planning and planning with dynamical systems in \fref{sec:soa-motion-pl}{Sections}\fref{sec:soa-dynamics-pl}{--\hspace{-.8ex}}. \fref{sec:soa-aerial-pl}{Section} is entirely dedicated to planning for aerial robots. In particular, we outline our findings on how planning in the literature occurs in terms of defining an autonomous flight plan. We then analyze the literature on energy modeling, state estimation, and optimal control for aerial robots. Although simultaneous dynamic planning of computations and motion is underrepresented, some recent contributions have proposed various techniques and motivated our analysis. We report these in detail in \fref{sec:soa-comp-motion-pl}{Section}.

This chapter connects to the remainder of this work as follows. In \fref{sec:soa-ene-mod}{Section} we discuss the state of the art on topics that allowed us to derive a dynamic energy planning approach for autonomous aerial robots. Based on these findings, we later propose a computations energy modeling technique to derive future energy consumption of mobile computing elements along with motion in \fref{cp:model}{Chapter}. Motion planning in the context of mobile robots and planning under dynamics are the basis for the derivation of the optimal configuration in \fref{cp:opt}{Chapter} of the plan and the planning problem that we defined in \fref{cp:pb}{Chapter}.       


\section{Computations Energy Modeling}
\label{sec:soa-ene-mod}

There are several different energy modeling and optimization approaches for computations, usually under the topic of energy efficiency for computing hardware.
Such hardware is carried by aerial robots that we analyze in this work and is often composed of heterogeneous elements: one or more CPUs and a GPU as we outlined in \fref{sec:motivation}{Section}. Energy efficiency is critical for both battery constrained devices~\citep{seewald202Xenergy} and a limiting factor in improving further computing performance~\citep{horowitz2014computing}. We split some of the available approaches in the literature into different classes, depending on their modeling and optimization approach. Due to the unpredictable nature of the heterogeneous elements, many contributions to energy modeling observe hardware characteristics and perform physical energy consumption measurements to derive an energy model~\citep{teamplay}. We analyze some of these contributions first. They treat the heterogeneous elements altogether and are of particular interest for our approach that likewise shares the same principle. We then analyze the techniques that focus on the energy of GPUs. Finally, we analyze techniques that treat CPUs. They are based on dynamic voltage scaling (\Gls{acr:dvs})\findex{dynamic voltage scaling}, a technique that scales down both the supply voltage and the frequency when there is no high computations demand~\citep{flautner2001automatic, chen2009fundamentals}. A review of techniques with different computing elements that focus on predictive modeling is provided in~\citep{oneal2018predictive} with emphasis on heterogeneous models based on machine learning.

Some other reviews that deal with energy modeling and focus on high-performance computing (HPC) systems~\citep{obrien2017survey,czarnul2019energy}. In the context of energy modeling, the survey provides existing tools for energy prediction in HPC systems in~\citep{czarnul2019energy} and the accuracy of different models in the literature in~\citep{obrien2017survey}. 

\subsection{Heterogeneous elements modeling}

Modern computing hardware energy modeling and optimization techniques often deal with the heterogeneous computing elements altogether using statistical tools~\citep{teamplay}. Such tools are inexpensive to deploy and relatively accurate in predicting future computations energy consumption~\citep{seewald2019coarse}. Although there are further optimizations available by looking at the elements (CPUs, GPUs) separately, these are often application and hardware-dependent. Instead, we focus on a generic computations energy model that can be used independently of the hardware and computations under analysis. 

A model for heterogeneous elements is derived in~\citep{marowka2017energy}. The model is based on some power metrics: the scaled speedup, scaled performance per watt, and scaled performance per joule. The author increases energy efficiency by choosing the configuration of the heterogeneous components: for instance, by enabling computations only on CPU cores, and hence, investigates the impact of different architectural choices on energy efficiency. In particular, the model is used to analyze the energy of three processing schemes: symmetric, asymmetric, and simultaneous. The former processing scheme utilizes merely a multicore CPU. Asymmetric processing scheme both CPU and GPU. The software benchmark on this scheme consists of running a program on one of the computing elements at a time. The latter processing scheme is similar to the previous one but the software benchmark runs on CPU and GPU simultaneously. Our work extends the model and builds an experimental method to the simultaneous processing scheme.

A more sophisticated statistical model that relies on multivariate linear regression for heterogeneous elements is derived in~\citep{bailey2014adaptive}. The model aims to allow selecting the application's configuration that maximizes performance under given power constraints. It is trained offline with a small set of benchmarks and works across multiple devices. The overall flow of the proposed approach is composed of two stages. The first stage is the offline training stage. It utilizes a small training set of benchmarks split into clusters. The model is built then with a regression per each cluster. After this stage follows the online predicting stage. The latter utilizes the model to predict the power and performance of a large set of applications (opposed to the relatively small number of benchmarks in the offline stage). Our work similarly models a subset of samples and infers properties of the entire search space. However, it focuses on heterogeneous mobile devices that we use for aerial robots.

A resource model for heterogeneous mobile devices developed in~\citep{goraczko2008energy} considers both the time and power of a given run-time mode (the authors use the term mode rather than configuration in~\citep{marowka2017energy,bailey2014adaptive} and in our work). Energy-wise, the resource model utilizes DVS as some other models in \fref{sec:soa-cpu}{Section} but accounts for heterogeneous systems. The approach models multiple processors with a state machine then used to derive a software partitioning problem--the problem of deriving the optimal mode. The problem is solved with an optimization technique: integer linear programming (ILP)\findex{integer linear programming}. The optimization occurs over an energy cost and with given deadline constraints. The intuition of formally defining the problem of deriving the optimal mode is similar in our work, which we further merge with the path planning for our dynamic energy planning.

Some computations-specific modeling approaches have been developed in the context of machine learning in~\citep{yang2017method}, and more recently surveyed in~\citep{garcia2019estimation}. Indeed, recent approaches are emerging to model the energy consumption of machine learning computations. The latter is a literature review motivated by the lack of appropriate tools to build and measure power models in existing machine learning suites. It describes the state of the art of energy estimation for convolutional neural networks (\Gls{acr:cnn}s) and data mining\findex{data mining}. In~\citep{yang2017method}, the approach evaluates an energy model of deep neural networks (\Gls{acr:dnn}s)\findex{deep neural network} based on a network bitwidth, sparsity, and architecture. The methodology applies exclusively to DNNs, but has been extended and used with other CNNs in~\citep{yang2017designing} in an optimization loop to reduce the computations energy consumption. A survey to optimize and evaluate neural networks on some of the embedded platforms that we use in this work (NVIDIA Jetson TK1 and TX2) specifically is proposed in~\citep{mittal2019survey}. 

A holistic approach for heterogeneous elements modeling is proposed in~\citep{ma2012holistic}. It achieves energy efficiency by splitting and distributing the workload among the heterogeneous elements, frequency scaling for the CPU and GPU, and \Gls{acr:dvs} for the CPU. GPU-side, the frequency is determined with a lightweight machine learning algorithm. Energy modeling in this approach is achieved by empirical means, using two power meters. The testbed under analysis--NVIDIA GeForce GPUs and AMD Phenom II CPUs--does not include built-in measurement units, and overall, the approach does not consider mobile computing heterogeneous hardware. Nevertheless, it is of interest in deriving insights on energy implications of energy efficiency of heterogeneous elements. 


\subsection{GPU features modeling}

GPUs are used in several applications due to their capacity of reaching high computational resources~\citep{kasichayanula2012power}. However, this comes at a price of increasing energy demands~\citep{mittal2014survey}. It is hence unsurprising that for computations energy modeling, GPUs have their own modeling approaches. Here we discuss some of the approaches of interest to our work. Extensive reviews of the available methodologies are in~\citep{mittal2014survey,bridges2016understanding} but are not tailored to portable computing hardware.

An energy model that analyzes GPU features is derived in~\citep{hong2010integrated}. The contribution consists of an integrated power and performance prediction model to derive the optimal number of active processors for a given application. The model predicts performance per watt and the optimal number of cores to achieve energy savings~\citep{hong2010integrated}. The model does not account for mobile computing hardware.

A similar focus on GPU features is proposed in~\citep{wu2015gpgpu}.  The model utilizes machine learning techniques to evaluate the performance and estimate the power from measurements of real GPU hardware. In particular, the approach trains a neural network by measuring different performance counters for various GPU configurations of a collection of applications. The data gathered from one hardware are used to estimate the power and performance for multiple other GPU hardware. Like the approaches in~\fref{sec:soa-hete}{Section}, the approach is computation independent and requires no source code analysis. It performs well for defining static offline modeling strategies, yet for aerial robots with systems suffering uncertainty, a dynamic approach is often favorable~\citep{seewald2019coarse}. Moreover, machine learning is an energy-expensive computation itself~\citep{garcia2019estimation,yang2017method}, thus deterring similar approaches in our planning where we aim to preserve the energy as far as possible.

An empirical approach for energy evaluations of GPUs during various computations in CUDA\findex{CUDA} environment is proposed in~\citep{collange2009power}. The approach measures and analyzes how computations impact instantaneous energy consumption. It observes a significant energy impact of memory accesses and generally analyzes the energy cost of parallel GPU computations. It does not use the measured data to calibrate a model for energy estimation, nor focus on mobile computing devices.

Opposed to the previous approach of pure empirical measurements, \citep{luo2011performance} proposes an analytical model for energy and performance estimation of GPUs. The model contains execution time and energy consumption prediction sub-models, where the latter follows from the former. The final analytical model for the energy estimation multiplies the execution time and the estimated power derived using an analytical expression. The accuracy analysis, redefined by the authors with another analytical expression, shows a strong correlation between observation and the analytical model. We also derive an analytical expression. We further motivate such expression with empirical observation of energy data and employ a multivariate linear regression. We then focus on heterogeneous elements and mobile computing hardware.

A model based on a performance-per-watt metric for GPUs is proposed in~\citep{leng2013gpuwattch}. Developed for general-purpose GPUs (GPGPU)\findex{genral purpose GPU}, it is composed of multiple stages. An initial model is validated with some empirical measurements and eventually refined.  The contribution suggests an integrated power and performance modeling framework, which inputs a configuration to define micro-architectural and component parameters. It is then used in a feedback-driven optimization loop with the GPGPU. The approach is relevant to our work. We similarly input a configuration to the model which specifies the computing hardware's computations. We use the output of the model in an optimization loop but extend this latter stage together with the path. Computation-wise, we model and work with both heterogeneous elements.

\subsection{CPU features modeling}
\label{sec:soa-cpu}

Numerous other contributions models the CPU energy specifically and investigate how to lower the power~\citep{hong1999power, luo2001battery, chowdhury2005static} by some system-level modeling and optimization techniques such as DVS, multiple asymmetric cores (such as the ARM big.LITTLE architecture), and power gating~\citep{walker2017accurate}. They usually include information about configuration parameters into the scheduler~\citep{seewald2019coarse} and focus on homogeneous opposite to heterogeneous systems in our work. 

A model for microprocessors based on regression is proposed in~\citep{lee2006statistically,lee2006accurate} and provides extensive coverage of regression modeling. The model is built with a small number of samples of both the power and performance in a joint architecture-computations search space. The approach uses the same model specification for power and performance. The entire search space is sampled uniformly at random, an approach that allows identifying trends and trade-offs between the parameters~\citep{lee2006accurate}. The results report high accuracy even with a relatively small number of samples. We likewise use a regression technique in our computations energy modeling approach but cover all the heterogeneous elements. Nonetheless, the approach is of interest to evaluate the accuracy of regression techniques and samples distributions. In fact, it is depending on the configuration space that we also sample the computations uniformly using a linear or exponential distribution of samples: we specify the sampling distance in a configuration file. 

Statistical multicore CPU\findex{multicore CPU} power models are presented in~\citep{takouna2011accurate}. These models are based on the average running frequency and the number of active cores. Commonly to other computations energy models, they use multivariate linear regression. Although insightful in terms of multicore CPU power models, the approach does not model GPUs nor heterogeneous elements. Moreover, it is tested on virtualized serves, opposed to mobile computing hardware that we focus on in this work. 

An empirical CPU power model is presented in~\citep{reddy2017empirical}. The model uses measured data and simulates the energy consumption of a quad-core ARM Cortex-A15 and gem5\findex{gem5}, a full-system architectural performance simulator. To collect the measurements, the model uses power sensors in the ODROID-XU3 platform and evaluates the model against sixty workloads reporting high accuracy (the average error between estimated and real power is less than six percent). Our model likewise shares compatibility with the ODROID-XU3 platform but is not simulator-dependent. It further extends to heterogeneous computing hardware such as NVIDIA Jetson platforms. 
 
Other models for mobile computing hardware based on the ODROID-XU3 platform are developed in~\citep{nunez2013enabling, nikov2015evaluation}. These models use hardware event registers and capture the state of the CPU under a representative workload. They have three modeling stages: data collection while a benchmark runs on the platform occurs in the first stage. The second and third stages are performed offline on a different architecture. They process the collected data (in the second stage) and generate the model (in the third stage)~\citep{seewald2019coarse}. Specifically, in~\citep{nikov2015evaluation} the model deals with ARM big.LITTLE architecture. We use these models to evaluate the performance of our computations energy modeling.

A run-time model that uses performance monitoring counters (PMCs)\findex{performance monitoring counters} for mobile computing hardware is proposed in~\citep{walker2017accurate}. The approach is implemented on mobile CPUs such as ARM Cortex-A7 and Cortex-A15 but can be implemented for other CPUs. Likewise in~\citep{reddy2017empirical}, the model can be used with the architectural performance simulator gem5, and likewise in~\citep{nunez2013enabling,nikov2015evaluation,reddy2017empirical} it is implemented on the ODROID-XU3 platform. The approach builds a linear regression for a given experiment for CPU power prediction. Although it considers CPU-powered computing hardware only, it is insightful in terms of proposed statistical rigor in building run-time CPU power models.

\section{Battery Energy Modeling}

There are several approaches to model the battery of ... 

---


For evaluating the effects of a battery as an energy source, we used the work done by~\citep{rao2003battery}. Their work summarizes state-of-the-art battery modeling into four classes of models that capture the battery state and its non-linearities. The lowest class contains the physical models that are accurate and model battery state evolution through a set of ordinary and partial differential equations. However, they suffer from a significant level of complexity that reflects on the time needed to produce predictions. The work proceeds by showing empirical models, that predict battery state from empirical trials. The third class consists of abstract models that we incorporated into our approach, in particular, by deriving the equation from the model developed by~\citep{hasan2018exogenous} (they model battery state through an equivalent electrical circuit and its evolution in time). The fourth class consists of mixed models where experimental data are collected and subsequently refined with analytical expressions to determine the models' parameters.


Our approach shares the same principle of differentiating the microcontroller from the companion computer with~\citep{mei2004energy, mei2005case}. The controller acts on the actuators and reads the sensors, while the companion computer (can be found with different names in literature, such as secondary or embedded computer), performs computationally heavy operations. A similar approach for mobile robots is presented by~\citep{dressler2005energy}. However, both contributions neither elaborate further on computational elements of a heterogeneous platform, such as GPU, nor focus on different robots except the one under analysis.

The majority of other contributions in the literature focus on optimizing motion planning to increase power efficiency. For instance, approaches to minimize UAV power consumption, such as the work by~\citep{kreciglowa2017energy}, aim to determine the best trajectory generation method for an aerial vehicle to travel from one configuration to another. Uragun suggests the use of power-efficient components~\citep{uragun2011energy}: an energy-efficient UAV system can either be built using conceptual product development with emerging technologies or using energy-efficient components. Kanellakis et al. affirm that integrating visual sensors in the UAV ecosystem still lacks solid experimental evaluation~\citep{kanellakis2017survey}. They suggest that to save energy, the available payload for sensing and computing has to be restricted. Our approach towards energy modeling shares a similar principle as the one presented by~\citep{sadrpour2013mission, sadrpour2013experimental} for Unmanned Ground Vehicles or UGVs. They propose a linear regression-based technique in the absence of real measurements and a Bayesian networks-based one in their presence. We used a simplified approximation technique to limit the number of computations needed while focusing rather on an accurate battery prediction.


Calore et al. develop an approach for measuring power efficiency for High-Performance Computing or HPC systems~\citep{calore2015energy}. An external board is used to measure the power consumption, while the data are collected from NVIDIA Jetson TK1 board running one benchmark. Our initial analysis presented at HLPGPU 2019 was made using a similar technique~\citep{seewald2019hlpgpu}. A shunt resistor and digital multimeter integrated into the external board was used to evaluate the power efficiency. In this paper we extend our experiments to use internal power monitors and address a broader range of platforms. We now build a proper energy model that reflects the computational behavior of the device under study and shows the energy evolution. An early report on our work has been presented in the TeamPlay project's deliverable D4.3~\citep{teamplay} ``Report on Energy, Timing and Security Modeling of Complex Architectures''.


\section{\color{cyan}Motion Planning}
\label{sec:soa-motion-pl}

Planning algorithms literature for mobile robots includes topics such as trajectory generation and path planning. Generally, the algorithms select an energy-optimized trajectory~\cite{mei2004energy}, e.g., by maximizing the operational time~\cite{wahab2015energy}. However, they apply to a small number of robots~\cite{kim2005energy} and focus exclusively on planning the trajectory~\cite{kim2008minimum}, despite compelling evidence for the energy consumption also being significantly influenced by computations~\cite{mei2005case}. Given the availability of powerful GPU-equipped mobile hardware~\cite{rizvi2017general}, the use of computations is expected to increase in the near future~\cite{abramov2012real,satria2016real,jaramillo2019visual}. More complex planning, which includes a broader concept of the plan being a set of tasks and a path, all focus on the trajectory~\cite{mei2005case,mei2006deployment} and apply to a small number of robots~\cite{sadrpour2013mission,sadrpour2013experimental}. For UAVs specifically, rotorcrafts have also gained interest in terms of algorithms for energy-optimized trajectory generation~\cite{morbidi2016minimum,kreciglowa2017energy}. 


\section{\color{red}Planning with Dynamics}
\label{sec:soa-dynamics-pl}

\section{\color{red}Planning for Autonomous Aerial Robots}
\label{sec:soa-aerial-pl}

\subsection{\color{red}Flight controllers}

\subsection{\color{orange}Energy models in aerial robotics}

\subsection{\color{orange}State estimation in aerial robotics}

\subsection{\color{orange}Optimal control in aerial robotics}


\section{\color{red}Planning Computations with Motion}
\label{sec:soa-comp-motion-pl}

\section{\color{red}Summary}

