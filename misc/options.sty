
%%%%%%%%%%%%%
%           %
% Options   %
%           %
\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=1100,stretch=10,shrink=10]{microtype} % better typography?

\usepackage{lettrine} % drop caps to chapter openings
\renewcommand{\LettrineFontHook}{\fontfamily{phv}}

\usepackage{graphicx}
\usepackage{amsfonts, amsmath, amssymb}
\usepackage[T1]{fontenc}
\usepackage[math]{iwona}
\usepackage{ebgaramond}

\usepackage[xindy,toc=false,nogroupskip]{glossaries-extra}
\usepackage{glossaries}
\usepackage{imakeidx}

\DeclareFontFamily{U}{futm}{} % trick for a sans serif mathbb
\DeclareFontShape{U}{futm}{m}{n}{
  <-> s * [.92] fourier-bb
  }{}
\DeclareSymbolFont{Ufutm}{U}{futm}{m}{n}
\DeclareSymbolFontAlphabet{\mathbb}{Ufutm}

\usepackage{helvet} % sans serif

\usepackage{xcolor} % colors
\definecolor{foo}{RGB}{0,51,102}

\newcommand*{\formatpagenum}[1]{\textcolor{foo}{\footnotesize\fontfamily{phv}\selectfont#1}}
\newcommand*{\findex}[1]{\index{#1|formatpagenum}}
\newcommand*{\fref}[2]{\textcolor{foo}{\footnotesize\fontfamily{phv}\selectfont#2~\ref{#1}}}
\newcommand*{\frefeq}[1]{\textcolor{foo}{\footnotesize\fontfamily{phv}\selectfont Equation~(\ref{#1})}}
\newcommand*{\frefeqM}[2]{\textcolor{foo}{\footnotesize\fontfamily{phv}\selectfont Equations~(\ref{#1}--\ref{#2})}}
\newcommand*{\frefeqT}[2]{\textcolor{foo}{\footnotesize\fontfamily{phv}\selectfont Equation~(\ref{#1})~and~(\ref{#2})}}

\indexsetup{othercode=\small}

\renewcommand{\glsnamefont}[1]{\textbf{#1}}

\newglossary*{notation}{Notation}
\newglossary*{acronym}{Abbreviations}

\renewcommand{\glossarypreamble}{%
 \glsfindwidesttoplevelname[\currentglossary]%
}

\newcommand{\hsp}{\kern 1pt} % for nested quotation marks

% Paragraph formatting
\renewcommand{\baselinestretch}{1.125} % paragraphs spreads the lines further
\setlength{\parskip}{0pt} % disable variable parskip
\setlength{\parindent}{1em}

\frenchspacing % no extra space after sentences

\widowpenalty=10000 % minus widows/orphans
\clubpenalty=10000

% page size
\usepackage[
    paperheight=9in,
    paperwidth=6in,
    top=0.75in,
    bottom=0.75in,
    outer=0.75in,
    inner=0.875in
]{geometry}

% reduce overfull \hbox{} warnings
\sloppy

% chapter headings
\usepackage[explicit]{titlesec}

\titleformat{\chapter}[display]
  {\fontfamily{phv}\selectfont\LARGE\bfseries\color{foo}}{\chaptertitlename\ \thechapter}
  {10pt}{\fontfamily{phv}\selectfont\huge#1}
\titlespacing*{\chapter}
  {0pt}{80pt}{40pt}  % controls vertical margins on title
\titleformat{\section}
  {\fontfamily{phv}\selectfont\large\bfseries\color{foo}}
  {\thesection}{1em}{#1}
\titleformat{\subsection}
  {\fontfamily{phv}\selectfont\bfseries\color{foo}}
  {\thesubsection}{1em}{#1}
\titleformat{\subsubsection}
  {\fontfamily{phv}\selectfont\bfseries\color{foo}}
  {\thesubsubsection}{1em}{#1}


% contents page
\usepackage[titles]{tocloft}
\renewcommand{\cftchapfont}{\small\fontfamily{phv}\selectfont\itshape}
\renewcommand{\cftsecfont}{\footnotesize\fontfamily{phv}\selectfont\itshape}
\renewcommand{\cftfigfont}{\footnotesize\fontfamily{phv}\selectfont\itshape}
\renewcommand{\cftsubsecfont}{\footnotesize\fontfamily{phv}\selectfont\itshape}
\renewcommand{\cftchappagefont}{\color{foo}\footnotesize\fontfamily{phv}\selectfont}
\renewcommand{\cftsecpagefont}{\color{foo}\footnotesize\fontfamily{phv}\selectfont}
\renewcommand{\cftsubsecpagefont}{\color{foo}\footnotesize\fontfamily{phv}\selectfont}
\renewcommand{\cftfigpagefont}{\color{foo}\footnotesize\fontfamily{phv}\selectfont}

% page number style
\usepackage{etoolbox}
\makeatletter
   \patchcmd{\ps@myheadings}{\hfil\thepage}{\fontfamily{phv}\selectfont\footnotesize\nouppercase\oldthepage\thepage}{}{}
\makeatother

% headers/footers
\usepackage{fancyhdr}
\setlength{\headheight}{15pt}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyhead[LE]{\fontfamily{phv}\selectfont\footnotesize\thepage}
\fancyhead[RO]{\fontfamily{phv}\selectfont\footnotesize\thepage}
\fancyhead[LO]{\fontfamily{phv}\selectfont\footnotesize\nouppercase{\rightmark}} 
\fancyhead[RE]{\fontfamily{phv}\selectfont\footnotesize\nouppercase{\leftmark}}

\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[C]{\fontfamily{phv}\selectfont\footnotesize\thepage}%
  \renewcommand{\headrulewidth}{0pt} % line at the header
  \renewcommand{\footrulewidth}{0pt} % line at the footer (both not visible)
}

% blank pages with disabled the current page style
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
   \hbox{}\thispagestyle{empty}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother

% bibliostyle
\PassOptionsToPackage{
  natbib=true,
  style=authoryear-comp,
  hyperref=true,
  backend=biber,
  maxbibnames=200,
  giveninits=true,
  uniquename=init,
  maxcitenames=2,
  parentracker=true,
  url=false,
  doi=false,
  isbn=false,
  eprint=false,
  backref=true,
}{biblatex}
\usepackage{biblatex}
\renewcommand*{\bibfont}{\fontfamily{phv}\selectfont\footnotesize}
\usepackage[hidelinks]{hyperref}
\hypersetup{allcolors=foo}
\renewcommand*{\citesetup}{%
  \color{foo}
  \footnotesize\fontfamily{phv}\selectfont
  \biburlsetup
  \frenchspacing
}

\DeclareNameAlias{sortname}{family-given} % counts in biblio

\defbibenvironment{bibliography}
  {\begin{enumerate}}
  {\end{enumerate}}
  {\item}

\usepackage{multirow} % tables
\usepackage{tabularx}

\usepackage{graphicx} % images
\graphicspath{ {./pictures/}{./figures/} } 
\usepackage{caption}
\usepackage{subcaption} % for subfigures
\DeclareCaptionFont{captionff}{\footnotesize\fontfamily{phv}\selectfont}
\captionsetup[figure]{labelsep=period,font=captionff}
\captionsetup[table]{labelsep=period,font=captionff}


\renewcommand{\thefigure}{\textcolor{foo}{\fontfamily{phv}\selectfont\thechapter.\arabic{figure}}}
\renewcommand{\figurename}{\textcolor{foo}{\fontfamily{phv}\selectfont Fig.}}
\renewcommand{\thetable}{\textcolor{foo}{\fontfamily{phv}\selectfont\arabic{table}}}
\renewcommand{\tablename}{\textcolor{foo}{\fontfamily{phv}\selectfont Table}}

\renewcommand{\theequation}{\footnotesize\textcolor{foo}{\fontfamily{phv}\selectfont\arabic{chapter}.\arabic{equation}}}

\makeatletter % equation parenthesis
\def\tagform@#1{{\color{foo}\maketag@@@{\fontfamily{phv}\selectfont\footnotesize(\ignorespaces#1\unskip\@@italiccorr)}}}
\makeatother

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,calc,automata,decorations.pathreplacing,backgrounds}
\tikzset{
  block/.style = {draw, fill=white, rectangle, minimum height=3em, minimum width=3em},
  tmp/.style  = {coordinate}, 
  sum/.style= {draw, fill=white, circle, node distance=1cm},
  input/.style = {coordinate},
  output/.style= {coordinate},
  pinstyle/.style = {pin edge={to-,thin,black}}
}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\renewcommand{\listfigurename}{Figures} % changing the title for the list of figures

\usepackage{thmtools}
\usepackage{amsthm,regexpatch}

\renewcommand{\qedsymbol}{$\blacksquare$}

\newtheoremstyle{komaplain}
  {\topsep}   % ABOVESPACE
  {\topsep}   % BELOWSPACE
  {}  % BODYFONT
  {0pt}       % INDENT (empty value is the same as 0pt)
  {\color{foo}\fontfamily{phv}\selectfont\footnotesize\bfseries} % HEADFONT
  {\newline}         % HEADPUNCT
  {5pt plus 1pt minus 1pt} % HEADSPACE
  {}          % CUSTOM-HEAD-SPEC

\theoremstyle{komaplain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{assm}[thm]{Assumption}
\newtheorem{cor}{Corollary}
\newtheorem{conj}{Conjecture}[section]
\newtheorem{defn}{Definition}[section]
\newtheorem{exmp}{Example}[section]
\newtheorem{pb}{Problem}[section]
\newtheorem{rem}{Remark}
\newtheorem*{st}{Status}
\newtheorem*{obs}{Observation}

\usepackage{tcolorbox}

\newtcolorbox{highlight}{colback=gray!10,
boxrule=0pt,arc=0pt,boxsep=2pt,left=2pt,right=2pt,leftrule=1pt}

\makeatletter
\newcommand*{\textlabel}[2]{%
  \edef\@currentlabel{#1}% Set target label
  \phantomsection% Correct hyper reference link
  #1\label{#2}% Print and store label
}
\makeatother % for textlabel

\usepackage[inline]{enumitem}

\newcommand{\stt}[1]{{\small\tt #1}} % \small\tt as tt is too big with the provided proof
\newcommand{\powprof}{\stt{powprofiler}}

\usepackage{diagbox}

\setlength\bibitemsep{1.5\itemsep} % more space to biblio

\usepackage[toc]{appendix}

